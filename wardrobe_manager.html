<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆ‘çš„è¡£æ©±</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/leancloud-storage@4.15.0/dist/av-min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#e91e63',
                        secondary: '#f8bbd9',
                        accent: '#fce4ec',
                        surface: '#ffffff',
                        background: '#fff5f8',
                        dark: '#2d2d2d',
                    },
                    fontFamily: { outfit: ['Outfit', 'sans-serif'] },
                    animation: {
                        'fade-in': 'fadeIn 0.4s ease-out',
                        'slide-up': 'slideUp 0.3s ease-out',
                        'pop': 'pop 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)',
                    },
                    keyframes: {
                        fadeIn: { '0%': { opacity: '0' }, '100%': { opacity: '1' } },
                        slideUp: { '0%': { opacity: '0', transform: 'translateY(20px)' }, '100%': { opacity: '1', transform: 'translateY(0)' } },
                        pop: { '0%': { transform: 'scale(0.9)', opacity: '0' }, '100%': { transform: 'scale(1)', opacity: '1' } }
                    }
                }
            }
        }
    </script>
    <style>
        [v-cloak] {
            display: none;
        }

        body {
            font-family: 'Outfit', system-ui, sans-serif;
            background: linear-gradient(135deg, #fff5f8 0%, #fce4ec 100%);
            min-height: 100vh;
        }

        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: #f8bbd9;
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #e91e63;
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.5);
        }

        .item-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .item-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 20px 40px -12px rgba(233, 30, 99, 0.25);
        }

        .nav-btn.active {
            background: linear-gradient(135deg, #e91e63, #f06292);
            color: white;
            box-shadow: 0 8px 20px -4px rgba(233, 30, 99, 0.4);
        }

        .category-chip {
            transition: all 0.2s ease;
        }

        .category-chip:hover {
            transform: scale(1.05);
        }

        .category-chip.active {
            background: linear-gradient(135deg, #e91e63, #f06292);
            color: white;
        }

        .stat-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9), rgba(255, 255, 255, 0.7));
        }

        .wear-count {
            position: absolute;
            bottom: 8px;
            right: 8px;
            background: rgba(0, 0, 0, 0.5);
            color: white;
            font-size: 12px;
            padding: 2px 8px;
            border-radius: 10px;
        }
    </style>
</head>

<body>
    <div id="app" v-cloak class="min-h-screen">
        <!-- ç™»å½•/é…ç½®ç•Œé¢ -->
        <div v-if="!isReady || !currentUser"
            class="fixed inset-0 z-[100] bg-gradient-to-br from-pink-50 to-pink-100 flex items-center justify-center p-4">
            <div class="glass-card p-8 rounded-3xl shadow-2xl w-full max-w-md animate-pop">
                <div class="text-center mb-8">
                    <div class="text-5xl mb-3">ğŸ‘—</div>
                    <h1
                        class="text-3xl font-bold bg-gradient-to-r from-pink-500 to-rose-500 bg-clip-text text-transparent">
                        æˆ‘çš„è¡£æ©±</h1>
                    <p class="text-gray-400 text-sm mt-2">æ™ºèƒ½è¡£ç‰©ç®¡ç†ç³»ç»Ÿ</p>
                </div>
                <div v-if="!hasConfig" class="space-y-4">
                    <div class="bg-pink-50 text-pink-700 p-3 rounded-xl text-xs">LeanCloud æ§åˆ¶å° > è®¾ç½® > åº”ç”¨å‡­è¯</div>
                    <input v-model="configForm.appId" placeholder="App ID"
                        class="w-full p-3 border border-pink-200 rounded-xl text-sm focus:ring-2 focus:ring-pink-300 outline-none">
                    <input v-model="configForm.appKey" type="password" placeholder="App Key"
                        class="w-full p-3 border border-pink-200 rounded-xl text-sm focus:ring-2 focus:ring-pink-300 outline-none">
                    <input v-model="configForm.serverURL" placeholder="REST API (https://...)"
                        class="w-full p-3 border border-pink-200 rounded-xl text-sm focus:ring-2 focus:ring-pink-300 outline-none">
                    <button @click="saveConfig"
                        class="w-full bg-gradient-to-r from-pink-500 to-rose-500 text-white py-3 rounded-xl font-medium hover:shadow-lg transition-all">ä¿å­˜é…ç½®</button>
                </div>
                <div v-else class="space-y-4">
                    <div class="flex border-b border-pink-200 mb-4">
                        <button @click="authMode='login'" :class="{'border-pink-500 text-pink-500': authMode==='login'}"
                            class="flex-1 pb-3 border-b-2 border-transparent font-medium">ç™»å½•</button>
                        <button @click="authMode='signup'"
                            :class="{'border-pink-500 text-pink-500': authMode==='signup'}"
                            class="flex-1 pb-3 border-b-2 border-transparent font-medium">æ³¨å†Œ</button>
                    </div>
                    <input v-model="authForm.username" placeholder="ç”¨æˆ·å"
                        class="w-full p-3 border border-pink-200 rounded-xl focus:ring-2 focus:ring-pink-300 outline-none">
                    <input v-model="authForm.password" type="password" placeholder="å¯†ç "
                        class="w-full p-3 border border-pink-200 rounded-xl focus:ring-2 focus:ring-pink-300 outline-none">
                    <button @click="handleAuth"
                        class="w-full bg-gradient-to-r from-pink-500 to-rose-500 text-white py-3 rounded-xl font-medium hover:shadow-lg transition-all">{{
                        authMode === 'login' ? 'è¿›å…¥è¡£æ©±' : 'ç«‹å³æ³¨å†Œ' }}</button>
                    <button @click="clearConfig"
                        class="text-xs text-gray-400 underline w-full text-center">é‡ç½®é…ç½®</button>
                </div>
            </div>
        </div>

        <!-- ä¸»ç•Œé¢ -->
        <div v-if="currentUser" class="pb-24">
            <!-- é¡¶éƒ¨å¯¼èˆª -->
            <header class="sticky top-0 z-40 glass-card px-6 py-4 shadow-sm">
                <div class="max-w-6xl mx-auto flex justify-between items-center">
                    <div class="flex items-center space-x-3">
                        <h1 class="text-xl font-bold text-dark">æˆ‘çš„è¡£æ©±</h1>
                        <span class="text-pink-400">></span>
                        <span class="text-gray-500">{{ currentViewTitle }}</span>
                    </div>
                    <div class="flex items-center space-x-3">
                        <button v-if="currentView === 'closet'" @click="openAddItemModal"
                            class="px-4 py-2 bg-gradient-to-r from-pink-500 to-rose-500 text-white rounded-full text-sm font-medium hover:shadow-lg transition-all flex items-center">
                            <span class="mr-1">+</span> æ·»åŠ å•å“
                        </button>
                        <button v-if="currentView === 'outfits'" @click="openAddOutfitModal"
                            class="px-4 py-2 bg-gradient-to-r from-pink-500 to-rose-500 text-white rounded-full text-sm font-medium hover:shadow-lg transition-all flex items-center">
                            <span class="mr-1">+</span> åˆ›å»ºæ­é…
                        </button>
                        <button v-if="currentView === 'ootd'" @click="openAddOotdModal"
                            class="px-4 py-2 bg-gradient-to-r from-pink-500 to-rose-500 text-white rounded-full text-sm font-medium hover:shadow-lg transition-all flex items-center">
                            <span class="mr-1">+</span> è®°å½•ç©¿æ­
                        </button>
                    </div>
                </div>
            </header>

            <div class="max-w-6xl mx-auto px-6 py-4">
                <!-- è¡£æ©±è§†å›¾ - ç›´æ¥å±•ç¤ºè¡£ç‰© -->
                <div v-if="currentView === 'closet'" class="animate-fade-in">
                    <!-- åˆ†ç±»å¤šé€‰ç­›é€‰ -->
                    <div class="flex flex-wrap gap-2 mb-6">
                        <button @click="closetFilters = []"
                            class="category-chip px-4 py-2 rounded-full text-sm font-medium"
                            :class="closetFilters.length === 0 ? 'active' : 'bg-white text-gray-600'">å…¨éƒ¨ ({{
                            items.length }})</button>
                        <button v-for="cat in categoryList" :key="cat.id" @click="toggleClosetFilter(cat.get('name'))"
                            class="category-chip px-4 py-2 rounded-full text-sm font-medium"
                            :class="closetFilters.includes(cat.get('name')) ? 'active' : 'bg-white text-gray-600'">
                            {{ getCategoryIcon(cat.get('name')) }} {{ cat.get('name') }} ({{
                            getCategoryCount(cat.get('name')) }})
                        </button>
                    </div>
                    <!-- æŒ‰åˆ†ç±»åˆ†ç»„å±•ç¤º -->
                    <div v-for="cat in displayCategories" :key="cat.name" class="mb-8">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-bold flex items-center">
                                <span class="mr-2">{{ getCategoryIcon(cat.name) }}</span>{{ cat.name }}
                            </h3>
                            <div class="flex items-center space-x-2">
                                <span class="text-pink-500 font-bold">{{ cat.count }} ä»¶</span>
                                <button v-if="cat.count > 6" @click="openCategoryDetail(cat.name)"
                                    class="text-sm text-pink-500 hover:text-pink-700 underline">æ›´å¤š ></button>
                            </div>
                        </div>
                        <div class="grid grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4">
                            <div v-for="item in cat.items.slice(0, 6)" :key="item.id" @click="openItemDetail(item)"
                                class="item-card bg-white rounded-2xl overflow-hidden shadow-sm cursor-pointer relative">
                                <div class="aspect-square bg-gray-50 flex items-center justify-center overflow-hidden">
                                    <img v-if="item.get('imageUrl')" :src="item.get('imageUrl')"
                                        class="w-full h-full object-cover" alt="">
                                    <span v-else class="text-4xl text-gray-300">ğŸ‘•</span>
                                </div>
                                <div class="wear-count">{{ item.get('wearCount') || 0 }}</div>
                            </div>
                            <!-- æ›´å¤šå¡ç‰‡ -->
                            <div v-if="cat.count > 6" @click="openCategoryDetail(cat.name)"
                                class="bg-pink-50 rounded-2xl flex flex-col items-center justify-center cursor-pointer hover:bg-pink-100 transition-colors aspect-square">
                                <span class="text-3xl text-pink-400 mb-1">+{{ cat.count - 6 }}</span>
                                <span class="text-sm text-pink-500">æŸ¥çœ‹æ›´å¤š</span>
                            </div>
                        </div>
                    </div>
                    <div v-if="items.length === 0" class="text-center py-16 text-gray-400">
                        <div class="text-6xl mb-4">ğŸ‘—</div>
                        <p>è¡£æ©±ç©ºç©ºå¦‚ä¹Ÿï¼Œå¿«æ¥æ·»åŠ å•å“å§ï¼</p>
                    </div>
                </div>

                <!-- æ­é…è§†å›¾ -->
                <div v-if="currentView === 'outfits'" class="animate-fade-in">
                    <!-- æœç´¢æ¡† -->
                    <div class="mb-6">
                        <input v-model="outfitSearchKeyword" type="text" placeholder="ğŸ” æœç´¢æ­é…åç§°æˆ–å¤‡æ³¨..."
                            class="w-full md:w-80 px-4 py-2.5 border border-gray-200 rounded-full text-sm bg-white focus:ring-2 focus:ring-pink-300 outline-none shadow-sm">
                    </div>
                    <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
                        <div v-for="outfit in filteredOutfits" :key="outfit.id" @click="openOutfitDetail(outfit)"
                            class="item-card bg-white rounded-2xl overflow-hidden shadow-sm cursor-pointer hover:shadow-lg transition-all">
                            <!-- è¡£ç‰©ç¼©ç•¥å›¾æ‹¼å›¾ -->
                            <div class="aspect-square bg-gray-50 p-2">
                                <div class="grid grid-cols-2 gap-1 h-full"
                                    v-if="(outfit.get('itemIds') || []).length > 0">
                                    <div v-for="(itemId, idx) in (outfit.get('itemIds') || []).slice(0, 4)"
                                        :key="itemId"
                                        class="bg-gray-100 rounded-lg overflow-hidden flex items-center justify-center">
                                        <img v-if="getItemById(itemId)?.get('imageUrl')"
                                            :src="getItemById(itemId)?.get('imageUrl')"
                                            class="w-full h-full object-cover" alt="">
                                        <span v-else class="text-gray-300 text-xl">{{
                                            getCategoryIcon(getItemById(itemId)?.get('category')) }}</span>
                                    </div>
                                    <div v-if="(outfit.get('itemIds') || []).length > 4"
                                        class="bg-pink-50 rounded-lg flex items-center justify-center text-pink-400 font-medium text-sm">
                                        +{{ (outfit.get('itemIds') || []).length - 4 }}
                                    </div>
                                </div>
                                <div v-else class="flex items-center justify-center h-full text-gray-300 text-4xl">ğŸ‘”
                                </div>
                            </div>
                            <div class="p-3">
                                <h4 class="font-medium text-sm truncate">{{ outfit.get('name') || 'æœªå‘½åæ­é…' }}</h4>
                                <p class="text-xs text-gray-400">{{ (outfit.get('itemIds') || []).length }} ä»¶å•å“</p>
                            </div>
                        </div>
                    </div>
                    <div v-if="filteredOutfits.length === 0" class="text-center py-16 text-gray-400">
                        <div class="text-6xl mb-4">ğŸ‘”</div>
                        <p>è¿˜æ²¡æœ‰æ­é…ï¼Œåˆ›å»ºä¸€å¥—å§ï¼</p>
                    </div>
                </div>

                <!-- OOTDè§†å›¾ -->
                <div v-if="currentView === 'ootd'" class="animate-fade-in">
                    <!-- æœç´¢å’Œæ—¶é—´ç­›é€‰ -->
                    <div class="flex flex-wrap gap-3 items-center mb-6 glass-card rounded-xl p-4">
                        <input v-model="ootdSearchKeyword" type="text" placeholder="ğŸ” æœç´¢æ ‡é¢˜æˆ–å¤‡æ³¨..."
                            class="flex-1 min-w-48 px-4 py-2 border border-gray-200 rounded-full text-sm bg-white focus:ring-2 focus:ring-pink-300 outline-none">
                        <span class="text-sm text-gray-500">æ—¶é—´ï¼š</span>
                        <input v-model="ootdDateFrom" type="date"
                            class="px-3 py-1.5 border border-gray-200 rounded-lg text-sm bg-white focus:ring-2 focus:ring-pink-300 outline-none">
                        <span class="text-gray-400">è‡³</span>
                        <input v-model="ootdDateTo" type="date"
                            class="px-3 py-1.5 border border-gray-200 rounded-lg text-sm bg-white focus:ring-2 focus:ring-pink-300 outline-none">
                        <button @click="ootdDateFrom=''; ootdDateTo=''; ootdSearchKeyword=''"
                            class="text-xs text-pink-500 hover:underline">é‡ç½®</button>
                    </div>
                    <div class="space-y-4">
                        <div v-for="ootd in filteredOotdList" :key="ootd.id" @click="openOotdDetail(ootd)"
                            class="glass-card rounded-2xl p-4 cursor-pointer hover:shadow-lg transition-all">
                            <div class="flex space-x-4">
                                <!-- å·¦ä¾§ï¼šè¡£ç‰©ç¼©ç•¥å›¾ -->
                                <div class="w-24 h-24 rounded-xl bg-gray-50 overflow-hidden flex-shrink-0 p-1">
                                    <div class="grid grid-cols-2 gap-0.5 h-full"
                                        v-if="(ootd.get('itemIds') || []).length > 0">
                                        <div v-for="itemId in (ootd.get('itemIds') || []).slice(0, 4)" :key="itemId"
                                            class="bg-gray-100 rounded overflow-hidden flex items-center justify-center">
                                            <img v-if="getItemById(itemId)?.get('imageUrl')"
                                                :src="getItemById(itemId)?.get('imageUrl')"
                                                class="w-full h-full object-cover" alt="">
                                            <span v-else class="text-gray-300 text-xs">ğŸ‘•</span>
                                        </div>
                                    </div>
                                    <div v-else-if="ootd.get('imageUrl')" class="h-full">
                                        <img :src="ootd.get('imageUrl')" class="w-full h-full object-cover rounded"
                                            alt="">
                                    </div>
                                    <div v-else class="flex items-center justify-center h-full text-3xl text-gray-300">
                                        ğŸ“…</div>
                                </div>
                                <!-- å³ä¾§ï¼šä¿¡æ¯ -->
                                <div class="flex-1">
                                    <div class="text-sm text-pink-500 font-medium mb-1">{{ formatDate(ootd.get('date'))
                                        }}</div>
                                    <h4 class="font-medium mb-1">{{ ootd.get('title') || 'ä»Šæ—¥ç©¿æ­' }}</h4>
                                    <p class="text-xs text-gray-400">{{ (ootd.get('itemIds') || []).length }} ä»¶å•å“</p>
                                    <p class="text-sm text-gray-500 line-clamp-1 mt-1">{{ ootd.get('note') || '' }}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div v-if="filteredOotdList.length === 0" class="text-center py-16 text-gray-400">
                        <div class="text-6xl mb-4">ğŸ“…</div>
                        <p>{{ ootdList.length === 0 ? 'è¿˜æ²¡æœ‰ç©¿æ­è®°å½•ï¼Œè®°å½•ä»Šå¤©çš„OOTDå§ï¼' : 'è¯¥æ—¶é—´èŒƒå›´å†…æ²¡æœ‰ç©¿æ­è®°å½•' }}</p>
                    </div>
                </div>

                <!-- æˆ‘çš„ - ç»Ÿè®¡ + è®¾ç½® -->
                <div v-if="currentView === 'profile'" class="space-y-6 animate-fade-in">
                    <!-- ç»Ÿè®¡æ¦‚è§ˆ -->
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <div class="stat-card rounded-2xl p-4 shadow-sm text-center">
                            <div class="text-3xl mb-1">ğŸ‘—</div>
                            <div class="text-2xl font-bold text-dark">{{ totalItems }}</div>
                            <div class="text-xs text-gray-500">å•å“æ€»æ•°</div>
                        </div>
                        <div class="stat-card rounded-2xl p-4 shadow-sm text-center">
                            <div class="text-3xl mb-1">ï¿½</div>
                            <div class="text-2xl font-bold text-pink-500">Â¥{{ totalValue.toFixed(0) }}</div>
                            <div class="text-xs text-gray-500">æ€»ä»·å€¼</div>
                        </div>
                        <div class="stat-card rounded-2xl p-4 shadow-sm text-center">
                            <div class="text-3xl mb-1">ğŸ‘”</div>
                            <div class="text-2xl font-bold text-dark">{{ totalOutfits }}</div>
                            <div class="text-xs text-gray-500">æ­é…æ•°</div>
                        </div>
                        <div class="stat-card rounded-2xl p-4 shadow-sm text-center">
                            <div class="text-3xl mb-1">ğŸ“…</div>
                            <div class="text-2xl font-bold text-dark">{{ totalOotd }}</div>
                            <div class="text-xs text-gray-500">ç©¿æ­æ—¥è®°</div>
                        </div>
                    </div>

                    <!-- åˆ†ç±»ç®¡ç† -->
                    <div class="glass-card rounded-2xl p-6">
                        <h3 class="font-bold mb-4 border-b border-pink-100 pb-3 flex justify-between">
                            <span>ğŸ“ åˆ†ç±»ç®¡ç†</span>
                            <span class="text-xs text-gray-400 font-normal">{{ categoryList.length }}/20</span>
                        </h3>
                        <div class="flex space-x-2 mb-4">
                            <input v-model="newCategoryName" placeholder="è¾“å…¥æ–°åˆ†ç±»åç§° (å¦‚ï¼šè£¤å­ã€åŠèº«è£™)"
                                class="flex-1 p-3 border border-pink-200 rounded-xl text-sm focus:ring-2 focus:ring-pink-300 outline-none">
                            <button @click="addCategory"
                                class="bg-gradient-to-r from-pink-500 to-rose-500 text-white px-5 py-2 rounded-xl text-sm font-medium hover:shadow-lg transition-all"
                                :disabled="categoryList.length >= 20">æ·»åŠ </button>
                        </div>
                        <div class="flex flex-wrap gap-2">
                            <div v-for="cat in categoryList" :key="cat.id"
                                class="bg-pink-50 text-pink-700 px-4 py-2 rounded-full text-sm flex items-center">
                                <span class="mr-1">{{ getCategoryIcon(cat.get('name')) }}</span>
                                {{ cat.get('name') }}
                                <button @click="removeCategory(cat)"
                                    class="ml-2 text-pink-400 hover:text-rose-500 font-bold">&times;</button>
                            </div>
                            <div v-if="categoryList.length === 0" class="text-gray-400 text-sm py-4">æš‚æ— åˆ†ç±»ï¼Œè¯·æ·»åŠ æ‚¨çš„è¡£ç‰©åˆ†ç±»
                            </div>
                        </div>
                    </div>

                    <!-- AIé…ç½® -->
                    <div class="glass-card rounded-2xl p-6">
                        <h3 class="font-bold mb-4 border-b border-pink-100 pb-3">ğŸ¤– AI é…ç½®</h3>
                        <p class="text-xs text-gray-400 mb-3">ç”¨äºAIæ™ºèƒ½æ­é…åŠŸèƒ½ï¼ˆOpenRouter API Keyï¼‰</p>
                        <div class="flex space-x-2">
                            <input v-model="aiKeyInput" type="password" placeholder="è¾“å…¥ OpenRouter API Key"
                                class="flex-1 p-3 border border-pink-200 rounded-xl text-sm focus:ring-2 focus:ring-pink-300 outline-none">
                            <button @click="saveAiKey"
                                class="bg-gradient-to-r from-pink-500 to-rose-500 text-white px-4 py-2 rounded-xl text-sm font-medium hover:shadow-lg transition-all">ä¿å­˜</button>
                        </div>
                        <p v-if="hasAiKey" class="text-xs text-green-500 mt-2">âœ“ AI Key å·²é…ç½®</p>
                    </div>

                    <!-- Hugging Faceé…ç½® -->
                    <div class="glass-card rounded-2xl p-6 mb-4">
                        <h3 class="font-bold mb-4 border-b border-pink-100 pb-3">ğŸ¤— AI è¯•ç©¿é…ç½®</h3>
                        <p class="text-xs text-gray-400 mb-2">Hugging Face Token (å¯é€‰ï¼Œå»ºè®®é…ç½®ä»¥è·å¾—æ›´ç¨³å®šè¿æ¥)</p>
                        <div class="flex space-x-2 mb-3">
                            <input v-model="hfTokenInput" type="password" placeholder="è¾“å…¥ HF Token"
                                class="flex-1 p-3 border border-pink-200 rounded-xl text-sm focus:ring-2 focus:ring-pink-300 outline-none">
                            <button @click="saveHfToken"
                                class="bg-gradient-to-r from-pink-500 to-rose-500 text-white px-4 py-2 rounded-xl text-sm font-medium hover:shadow-lg transition-all">ä¿å­˜</button>
                        </div>
                        <p class="text-xs text-gray-400 mb-2">è‡ªå®šä¹‰ Space ID (å¯é€‰ï¼Œå¦‚é‡è¿æ¥å¤±è´¥å¯å°è¯•æ›´æ¢é•œåƒ)</p>
                        <div class="flex space-x-2">
                            <input v-model="customSpaceIdInput" type="text" placeholder="ä¾‹å¦‚: yisol/IDM-VTON"
                                class="flex-1 p-3 border border-pink-200 rounded-xl text-sm focus:ring-2 focus:ring-pink-300 outline-none">
                            <button @click="saveCustomSpace"
                                class="bg-gray-500 text-white px-4 py-2 rounded-xl text-sm font-medium hover:shadow-lg transition-all">ä¿å­˜</button>
                        </div>
                        <div class="flex flex-col mt-2 gap-1">
                            <p v-if="hasHfToken" class="text-xs text-green-500">âœ“ HF Token å·²é…ç½®</p>
                            <p v-if="hasCustomSpace" class="text-xs text-blue-500">âœ“ è‡ªå®šä¹‰ Space: {{ customSpaceIdInput }}
                            </p>
                        </div>
                    </div>

                    <!-- è´¦å·ä¿¡æ¯ -->
                    <div class="glass-card rounded-2xl p-6">
                        <h3 class="font-bold mb-4 border-b border-pink-100 pb-3">ğŸ‘¤ è´¦å·ä¿¡æ¯</h3>
                        <p class="text-sm text-gray-600 mb-3">å½“å‰ç”¨æˆ·: {{ currentUser.getUsername() }}</p>
                        <button @click="handleLogout"
                            class="text-sm text-rose-500 border border-rose-300 px-4 py-2 rounded-xl hover:bg-rose-50 transition-all">é€€å‡ºç™»å½•</button>
                    </div>
                </div>
            </div>

            <!-- åº•éƒ¨å¯¼èˆª -->
            <nav class="fixed bottom-0 left-0 right-0 glass-card border-t border-pink-100 z-50">
                <div class="max-w-md mx-auto flex justify-around py-3">
                    <button @click="currentView='closet'"
                        :class="currentView==='closet' ? 'text-pink-500' : 'text-gray-400'"
                        class="flex flex-col items-center transition-colors">
                        <span class="text-2xl">ğŸ‘—</span><span class="text-xs mt-1">è¡£æ©±</span>
                    </button>
                    <button @click="currentView='outfits'"
                        :class="currentView==='outfits' ? 'text-pink-500' : 'text-gray-400'"
                        class="flex flex-col items-center transition-colors">
                        <span class="text-2xl">ğŸ‘”</span><span class="text-xs mt-1">æ­é…</span>
                    </button>
                    <button @click="currentView='ootd'"
                        :class="currentView==='ootd' ? 'text-pink-500' : 'text-gray-400'"
                        class="flex flex-col items-center transition-colors">
                        <span class="text-2xl">ğŸ“…</span><span class="text-xs mt-1">OOTD</span>
                    </button>
                    <button @click="currentView='profile'"
                        :class="currentView==='profile' ? 'text-pink-500' : 'text-gray-400'"
                        class="flex flex-col items-center transition-colors">
                        <span class="text-2xl">ï¿½</span><span class="text-xs mt-1">æˆ‘çš„</span>
                    </button>
                </div>
            </nav>
        </div>

        <!-- åˆ†ç±»è¯¦æƒ…å¼¹çª— -->
        <div v-if="showCategoryDetailModal"
            class="fixed inset-0 z-[55] bg-black/50 flex items-center justify-center p-4"
            @click.self="showCategoryDetailModal=false">
            <div class="glass-card w-full max-w-4xl rounded-2xl shadow-2xl flex flex-col max-h-[90vh] animate-pop">
                <div class="p-4 border-b border-pink-100 flex justify-between items-center">
                    <h3 class="font-bold text-lg flex items-center">
                        <span class="mr-2">{{ getCategoryIcon(categoryDetailName) }}</span>
                        {{ categoryDetailName }}
                        <span class="ml-2 text-sm text-pink-500 font-normal">({{ getCategoryCount(categoryDetailName)
                            }}ä»¶)</span>
                    </h3>
                    <button @click="showCategoryDetailModal=false"
                        class="text-2xl text-gray-400 hover:text-gray-600">&times;</button>
                </div>
                <div class="p-4 border-b border-pink-100">
                    <!-- ç­›é€‰æ¡ä»¶ -->
                    <div class="flex flex-wrap gap-3 items-center">
                        <div class="flex items-center space-x-2">
                            <span class="text-xs text-gray-500">æ’åºï¼š</span>
                            <select v-model="categoryDetailSort"
                                class="px-3 py-1.5 border border-gray-200 rounded-lg text-sm bg-white focus:ring-2 focus:ring-pink-300 outline-none">
                                <option value="newest">æœ€æ–°æ·»åŠ </option>
                                <option value="price_asc">ä»·æ ¼ä»ä½åˆ°é«˜</option>
                                <option value="price_desc">ä»·æ ¼ä»é«˜åˆ°ä½</option>
                                <option value="wear_asc">ç©¿ç€æ¬¡æ•°å°‘</option>
                                <option value="wear_desc">ç©¿ç€æ¬¡æ•°å¤š</option>
                            </select>
                        </div>
                        <div class="flex items-center space-x-2">
                            <span class="text-xs text-gray-500">ä»·æ ¼ï¼š</span>
                            <input v-model.number="categoryDetailMinPrice" type="number" placeholder="æœ€ä½"
                                class="w-20 px-2 py-1.5 border border-gray-200 rounded-lg text-sm bg-white focus:ring-2 focus:ring-pink-300 outline-none">
                            <span class="text-gray-400">-</span>
                            <input v-model.number="categoryDetailMaxPrice" type="number" placeholder="æœ€é«˜"
                                class="w-20 px-2 py-1.5 border border-gray-200 rounded-lg text-sm bg-white focus:ring-2 focus:ring-pink-300 outline-none">
                        </div>
                        <div class="flex items-center space-x-2">
                            <span class="text-xs text-gray-500">ç©¿ç€æ¬¡æ•°ï¼š</span>
                            <input v-model.number="categoryDetailMinWear" type="number" placeholder="æœ€å°‘"
                                class="w-16 px-2 py-1.5 border border-gray-200 rounded-lg text-sm bg-white focus:ring-2 focus:ring-pink-300 outline-none">
                            <span class="text-gray-400">-</span>
                            <input v-model.number="categoryDetailMaxWear" type="number" placeholder="æœ€å¤š"
                                class="w-16 px-2 py-1.5 border border-gray-200 rounded-lg text-sm bg-white focus:ring-2 focus:ring-pink-300 outline-none">
                        </div>
                        <button @click="resetCategoryDetailFilters"
                            class="text-xs text-pink-500 hover:underline">é‡ç½®</button>
                    </div>
                </div>
                <div class="p-6 overflow-y-auto flex-1">
                    <div class="grid grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4">
                        <div v-for="item in filteredCategoryItems" :key="item.id"
                            @click="openItemDetail(item); showCategoryDetailModal=false"
                            class="item-card bg-white rounded-2xl overflow-hidden shadow-sm cursor-pointer relative hover:shadow-md transition-all">
                            <div class="aspect-square bg-gray-50 flex items-center justify-center overflow-hidden">
                                <img v-if="item.get('imageUrl')" :src="item.get('imageUrl')"
                                    class="w-full h-full object-cover" alt="">
                                <span v-else class="text-4xl text-gray-300">ğŸ‘•</span>
                            </div>
                            <div class="p-2 text-center">
                                <p class="text-xs text-pink-500 font-medium">Â¥{{ item.get('price') || 0 }}</p>
                                <p class="text-xs text-gray-400">ç©¿äº†{{ item.get('wearCount') || 0 }}æ¬¡</p>
                            </div>
                            <div class="wear-count">{{ item.get('wearCount') || 0 }}</div>
                        </div>
                    </div>
                    <p v-if="filteredCategoryItems.length === 0" class="text-center text-gray-400 py-8">æ— ç¬¦åˆæ¡ä»¶çš„è¡£ç‰©</p>
                </div>
            </div>
        </div>

        <!-- æ·»åŠ å•å“å¼¹çª— -->
        <div v-if="showItemModal" class="fixed inset-0 z-[60] bg-black/50 flex items-center justify-center p-4"
            @click.self="closeItemModal">
            <div class="glass-card w-full max-w-lg rounded-2xl shadow-2xl flex flex-col max-h-[90vh] animate-pop">
                <div class="p-4 border-b border-pink-100 flex justify-between items-center">
                    <h3 class="font-bold text-lg">{{ isEditingItem ? 'ç¼–è¾‘å•å“' : 'æ·»åŠ å•å“' }}</h3>
                    <button @click="closeItemModal" class="text-2xl text-gray-400 hover:text-gray-600">&times;</button>
                </div>
                <div class="p-6 overflow-y-auto space-y-4">
                    <div>
                        <label class="text-xs font-bold text-gray-500 block mb-2">å•å“å›¾ç‰‡</label>
                        <div class="border-2 border-dashed border-pink-200 rounded-xl p-4 text-center cursor-pointer hover:border-pink-400 transition-colors"
                            @click="$refs.itemImageInput.click()">
                            <div v-if="itemForm.imageUrl" class="relative">
                                <img :src="itemForm.imageUrl" class="max-h-48 mx-auto rounded-lg">
                                <button @click.stop="removeItemImage"
                                    class="absolute top-2 right-2 bg-red-500 text-white w-6 h-6 rounded-full text-sm">&times;</button>
                            </div>
                            <div v-else class="py-8">
                                <span class="text-4xl text-gray-300 block mb-2">ğŸ“·</span>
                                <span class="text-sm text-gray-400">ç‚¹å‡»ä¸Šä¼ å›¾ç‰‡</span>
                            </div>
                        </div>
                        <input ref="itemImageInput" type="file" class="hidden" accept="image/*"
                            @change="handleItemImageUpload">
                    </div>
                    <div>
                        <label class="text-xs font-bold text-gray-500 block mb-2">åˆ†ç±» <span
                                class="text-rose-500">*</span></label>
                        <select v-model="itemForm.category"
                            class="w-full p-3 border border-pink-200 rounded-xl bg-white focus:ring-2 focus:ring-pink-300 outline-none">
                            <option value="" disabled>-- è¯·é€‰æ‹©åˆ†ç±» --</option>
                            <option v-for="cat in categoryList" :key="cat.id" :value="cat.get('name')">{{
                                cat.get('name') }}</option>
                        </select>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="text-xs font-bold text-gray-500 block mb-2">ä»·æ ¼ (å…ƒ)</label>
                            <input v-model.number="itemForm.price" type="number" placeholder="0.00"
                                class="w-full p-3 border border-pink-200 rounded-xl focus:ring-2 focus:ring-pink-300 outline-none">
                        </div>
                        <div>
                            <label class="text-xs font-bold text-gray-500 block mb-2">å“ç‰Œ</label>
                            <input v-model="itemForm.brand" placeholder="å“ç‰Œåç§°"
                                class="w-full p-3 border border-pink-200 rounded-xl focus:ring-2 focus:ring-pink-300 outline-none">
                        </div>
                    </div>
                    <div>
                        <label class="text-xs font-bold text-gray-500 block mb-2">å¤‡æ³¨</label>
                        <textarea v-model="itemForm.note" placeholder="å¯é€‰çš„å¤‡æ³¨ä¿¡æ¯..." rows="2"
                            class="w-full p-3 border border-pink-200 rounded-xl focus:ring-2 focus:ring-pink-300 outline-none resize-none"></textarea>
                    </div>
                </div>
                <div class="p-4 border-t border-pink-100 flex justify-end space-x-3">
                    <button @click="closeItemModal"
                        class="px-5 py-2 text-gray-600 hover:bg-gray-100 rounded-xl transition-colors">å–æ¶ˆ</button>
                    <button @click="saveItem" :disabled="isUploading"
                        class="px-6 py-2 bg-gradient-to-r from-pink-500 to-rose-500 text-white rounded-xl font-medium hover:shadow-lg transition-all disabled:opacity-50">{{
                        isUploading ? 'ä¸Šä¼ ä¸­...' : 'ä¿å­˜' }}</button>
                </div>
            </div>
        </div>

        <!-- æ·»åŠ æ­é…å¼¹çª— -->
        <div v-if="showOutfitModal" class="fixed inset-0 z-[60] bg-black/50 flex items-center justify-center p-4"
            @click.self="closeOutfitModal">
            <div class="glass-card w-full max-w-2xl rounded-2xl shadow-2xl flex flex-col max-h-[90vh] animate-pop">
                <div class="p-4 border-b border-pink-100 flex justify-between items-center">
                    <h3 class="font-bold text-lg">{{ isEditingOutfit ? 'ç¼–è¾‘æ­é…' : 'åˆ›å»ºæ­é…' }}</h3>
                    <button @click="closeOutfitModal"
                        class="text-2xl text-gray-400 hover:text-gray-600">&times;</button>
                </div>
                <div class="p-6 overflow-y-auto space-y-4">
                    <!-- AIæ­é…åŒºåŸŸ -->
                    <div v-if="!isEditingOutfit"
                        class="bg-gradient-to-r from-purple-50 to-pink-50 rounded-xl p-4 border border-purple-100">
                        <div class="flex items-center justify-between mb-3">
                            <h4 class="font-bold text-purple-700 flex items-center"><span class="mr-2">ğŸ¤–</span>AI æ™ºèƒ½æ­é…
                            </h4>
                            <span class="text-xs text-purple-400">è®©AIå¸®ä½ æ­é…ä»Šæ—¥ç©¿æ­</span>
                        </div>
                        <div class="mb-3">
                            <label class="text-xs text-gray-500 block mb-2">é€‰æ‹©è¦æ­é…çš„åˆ†ç±»ï¼ˆå¯å¤šé€‰ï¼Œä¸é€‰åˆ™éšæœºï¼‰</label>
                            <div class="flex flex-wrap gap-2">
                                <button v-for="cat in categoryList" :key="cat.id"
                                    @click="toggleAiCategory(cat.get('name'))"
                                    :class="aiSelectedCategories.includes(cat.get('name')) ? 'bg-purple-500 text-white' : 'bg-white text-gray-600 border border-gray-200'"
                                    class="px-3 py-1.5 rounded-full text-xs font-medium transition-all hover:shadow">
                                    {{ getCategoryIcon(cat.get('name')) }} {{ cat.get('name') }}
                                </button>
                            </div>
                        </div>
                        <button @click="generateAiOutfit" :disabled="isAiGenerating || items.length === 0"
                            class="w-full py-3 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-xl font-medium hover:shadow-lg transition-all disabled:opacity-50 flex items-center justify-center">
                            <span v-if="isAiGenerating">ğŸ”„ AIæ­£åœ¨æ€è€ƒ...</span>
                            <span v-else>âœ¨ ç”ŸæˆAIæ­é…å»ºè®®</span>
                        </button>
                    </div>

                    <div class="text-center text-gray-400 text-sm">â€” æˆ–æ‰‹åŠ¨é€‰æ‹©è¡£ç‰©æ­é… â€”</div>

                    <!-- æ‰‹åŠ¨é€‰æ‹©è¡£ç‰©åŒºåŸŸ -->
                    <div class="bg-gray-50 rounded-xl p-4 border border-gray-200">
                        <div class="flex items-center justify-between mb-3">
                            <h4 class="font-bold text-gray-700 flex items-center"><span class="mr-2">ğŸ‘”</span>é€‰æ‹©æ­é…å•å“
                            </h4>
                            <span class="text-xs text-pink-500 font-medium">å·²é€‰ {{ outfitForm.selectedItems.length }}
                                ä»¶</span>
                        </div>

                        <!-- ç­›é€‰æ¡ä»¶ -->
                        <div class="flex flex-wrap gap-2 mb-3">
                            <select v-model="outfitPickerCategory"
                                class="px-3 py-1.5 border border-gray-200 rounded-lg text-sm bg-white focus:ring-2 focus:ring-pink-300 outline-none">
                                <option value="">å…¨éƒ¨åˆ†ç±»</option>
                                <option v-for="cat in categoryList" :key="cat.id" :value="cat.get('name')">
                                    {{ getCategoryIcon(cat.get('name')) }} {{ cat.get('name') }}
                                </option>
                            </select>
                            <select v-model="outfitPickerSort"
                                class="px-3 py-1.5 border border-gray-200 rounded-lg text-sm bg-white focus:ring-2 focus:ring-pink-300 outline-none">
                                <option value="newest">æœ€æ–°æ·»åŠ </option>
                                <option value="price_asc">ä»·æ ¼ä»ä½åˆ°é«˜</option>
                                <option value="price_desc">ä»·æ ¼ä»é«˜åˆ°ä½</option>
                                <option value="wear_asc">ç©¿ç€æ¬¡æ•°å°‘</option>
                                <option value="wear_desc">ç©¿ç€æ¬¡æ•°å¤š</option>
                            </select>
                            <input v-model.number="outfitPickerMaxPrice" type="number" placeholder="æœ€é«˜ä»·æ ¼"
                                class="w-24 px-3 py-1.5 border border-gray-200 rounded-lg text-sm bg-white focus:ring-2 focus:ring-pink-300 outline-none">
                        </div>

                        <!-- å¯é€‰è¡£ç‰©åˆ—è¡¨ -->
                        <div class="grid grid-cols-4 gap-2 max-h-48 overflow-y-auto">
                            <div v-for="item in filteredPickerItems" :key="item.id" @click="toggleOutfitItem(item)"
                                :class="outfitForm.selectedItems.includes(item.id) ? 'ring-2 ring-pink-500 bg-pink-50' : 'bg-white'"
                                class="rounded-xl overflow-hidden shadow-sm cursor-pointer transition-all hover:shadow-md relative">
                                <div class="aspect-square bg-gray-100 flex items-center justify-center overflow-hidden">
                                    <img v-if="item.get('imageUrl')" :src="item.get('imageUrl')"
                                        class="w-full h-full object-cover">
                                    <span v-else class="text-2xl text-gray-300">ï¿½</span>
                                </div>
                                <div class="p-1.5 text-center">
                                    <p class="text-xs text-gray-500 truncate">{{ item.get('category') }}</p>
                                    <p class="text-xs text-pink-500 font-medium">Â¥{{ item.get('price') || 0 }}</p>
                                </div>
                                <div v-if="outfitForm.selectedItems.includes(item.id)"
                                    class="absolute top-1 right-1 w-5 h-5 bg-pink-500 rounded-full flex items-center justify-center text-white text-xs">
                                    âœ“</div>
                            </div>
                        </div>
                        <p v-if="filteredPickerItems.length === 0" class="text-center text-gray-400 text-sm py-4">
                            æš‚æ— ç¬¦åˆæ¡ä»¶çš„è¡£ç‰©
                        </p>

                        <!-- å·²é€‰è¡£ç‰©é¢„è§ˆ -->
                        <div v-if="outfitForm.selectedItems.length > 0" class="mt-3 pt-3 border-t border-gray-200">
                            <p class="text-xs text-gray-500 mb-2">å·²é€‰å•å“ï¼š</p>
                            <div class="flex flex-wrap gap-2">
                                <div v-for="itemId in outfitForm.selectedItems" :key="itemId"
                                    class="flex items-center bg-pink-100 text-pink-700 px-2 py-1 rounded-full text-xs">
                                    <span>{{ getItemById(itemId)?.get('category') }}</span>
                                    <button @click.stop="toggleOutfitItem(getItemById(itemId))"
                                        class="ml-1 text-pink-500 hover:text-pink-700">&times;</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div>
                        <label class="text-xs font-bold text-gray-500 block mb-2">æ­é…åç§°</label>
                        <input v-model="outfitForm.name" placeholder="ç»™è¿™å¥—æ­é…èµ·ä¸ªåå­—"
                            class="w-full p-3 border border-pink-200 rounded-xl focus:ring-2 focus:ring-pink-300 outline-none">
                    </div>
                    <div>
                        <label class="text-xs font-bold text-gray-500 block mb-2">å¤‡æ³¨</label>
                        <textarea v-model="outfitForm.note" placeholder="æ­é…è¯´æ˜..." rows="2"
                            class="w-full p-3 border border-pink-200 rounded-xl focus:ring-2 focus:ring-pink-300 outline-none resize-none"></textarea>
                    </div>
                </div>
                <div class="p-4 border-t border-pink-100 flex justify-end space-x-3">
                    <button @click="closeOutfitModal"
                        class="px-5 py-2 text-gray-600 hover:bg-gray-100 rounded-xl transition-colors">å–æ¶ˆ</button>
                    <button @click="saveOutfit" :disabled="isUploading || outfitForm.selectedItems.length === 0"
                        class="px-6 py-2 bg-gradient-to-r from-pink-500 to-rose-500 text-white rounded-xl font-medium hover:shadow-lg transition-all disabled:opacity-50">
                        ä¿å­˜æ­é… ({{ outfitForm.selectedItems.length }}ä»¶)</button>
                </div>
            </div>
        </div>

        <!-- æ­é…è¯¦æƒ…å¼¹çª— -->
        <div v-if="showOutfitDetailModal && currentOutfit"
            class="fixed inset-0 z-[65] bg-black/50 flex items-center justify-center p-4"
            @click.self="showOutfitDetailModal=false">
            <div class="glass-card w-full max-w-lg rounded-2xl shadow-2xl flex flex-col max-h-[90vh] animate-pop">
                <div class="p-4 border-b border-pink-100 flex justify-between items-center">
                    <h3 class="font-bold text-lg">{{ currentOutfit.get('name') || 'æ­é…è¯¦æƒ…' }}</h3>
                    <button @click="showOutfitDetailModal=false"
                        class="text-2xl text-gray-400 hover:text-gray-600">&times;</button>
                </div>
                <div class="p-6 overflow-y-auto">
                    <p class="text-xs text-gray-400 mb-4">åˆ›å»ºäº {{ formatDate(currentOutfit.createdAt) }}</p>

                    <!-- åŒ…å«çš„å•å“ -->
                    <h4 class="font-medium text-gray-700 mb-3">åŒ…å«å•å“ ({{ (currentOutfit.get('itemIds') || []).length }}ä»¶)
                    </h4>
                    <div class="grid grid-cols-3 gap-3 mb-4">
                        <div v-for="itemId in (currentOutfit.get('itemIds') || [])" :key="itemId"
                            class="bg-white rounded-xl p-2 shadow-sm border cursor-pointer hover:shadow-md transition-all"
                            @click="openItemDetail(getItemById(itemId)); showOutfitDetailModal=false">
                            <div class="aspect-square bg-gray-50 rounded-lg overflow-hidden mb-1">
                                <img v-if="getItemById(itemId)?.get('imageUrl')"
                                    :src="getItemById(itemId)?.get('imageUrl')" class="w-full h-full object-cover">
                                <span v-else
                                    class="flex items-center justify-center h-full text-2xl text-gray-300">ğŸ‘•</span>
                            </div>
                            <p class="text-xs text-center text-gray-500 truncate">{{
                                getItemById(itemId)?.get('category') }}</p>
                            <p class="text-xs text-center text-pink-500">Â¥{{ getItemById(itemId)?.get('price') || 0 }}
                            </p>
                        </div>
                    </div>

                    <!-- å¤‡æ³¨ -->
                    <div v-if="currentOutfit.get('note')" class="bg-gray-50 rounded-xl p-4">
                        <h4 class="font-medium text-gray-700 mb-2">å¤‡æ³¨</h4>
                        <p class="text-sm text-gray-600">{{ currentOutfit.get('note') }}</p>
                    </div>
                </div>
                <div class="p-4 border-t border-pink-100 flex justify-between">
                    <button @click="deleteOutfit(currentOutfit)"
                        class="px-4 py-2 text-red-500 hover:bg-red-50 rounded-xl transition-colors">
                        ğŸ—‘ï¸ åˆ é™¤
                    </button>
                    <div class="flex space-x-2">
                        <button @click="openAiTryOn('outfit', currentOutfit)"
                            class="px-5 py-2 bg-indigo-50 text-indigo-600 rounded-xl font-medium hover:bg-indigo-100 transition-all">
                            ğŸ¤– AI è¯•ç©¿
                        </button>
                        <button @click="editOutfit(currentOutfit)"
                            class="px-5 py-2 bg-pink-50 text-pink-600 rounded-xl font-medium hover:bg-pink-100 transition-all">
                            âœï¸ ç¼–è¾‘
                        </button>
                        <button @click="showOutfitDetailModal=false"
                            class="px-6 py-2 bg-gradient-to-r from-pink-500 to-rose-500 text-white rounded-xl font-medium hover:shadow-lg transition-all">
                            å…³é—­
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- AIæ­é…ç»“æœå¼¹çª— -->
        <div v-if="showAiResultModal" class="fixed inset-0 z-[70] bg-black/50 flex items-center justify-center p-4"
            @click.self="showAiResultModal=false">
            <div class="glass-card w-full max-w-lg rounded-2xl shadow-2xl flex flex-col max-h-[90vh] animate-pop">
                <div class="p-4 border-b border-purple-100 bg-gradient-to-r from-purple-50 to-pink-50 rounded-t-2xl">
                    <h3 class="font-bold text-lg text-purple-700 flex items-center"><span class="mr-2">ğŸ¤–</span>AI æ­é…å»ºè®®
                    </h3>
                </div>
                <div class="p-6 overflow-y-auto">
                    <div class="mb-4">
                        <h4 class="font-medium text-gray-700 mb-2">æ¨èå•å“ï¼š</h4>
                        <div class="grid grid-cols-3 gap-3">
                            <div v-for="item in aiResult.items" :key="item.id"
                                class="bg-white rounded-xl p-2 shadow-sm border">
                                <div class="aspect-square bg-gray-50 rounded-lg overflow-hidden mb-1">
                                    <img v-if="item.get('imageUrl')" :src="item.get('imageUrl')"
                                        class="w-full h-full object-cover">
                                    <span v-else
                                        class="flex items-center justify-center h-full text-2xl text-gray-300">ğŸ‘•</span>
                                </div>
                                <p class="text-xs text-center text-gray-500 truncate">{{ item.get('category') }}</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-purple-50 rounded-xl p-4 border border-purple-100">
                        <h4 class="font-medium text-purple-700 mb-2 flex items-center"><span class="mr-1">ğŸ’¡</span>æ­é…ç†ç”±
                        </h4>
                        <p class="text-sm text-gray-700 leading-relaxed">{{ aiResult.reason }}</p>
                    </div>
                </div>
                <div class="p-4 border-t border-pink-100 flex justify-between">
                    <button @click="showAiResultModal=false"
                        class="px-5 py-2 text-gray-600 hover:bg-gray-100 rounded-xl transition-colors">å…³é—­</button>
                    <div class="flex space-x-3">
                        <button @click="generateAiOutfit"
                            class="px-4 py-2 bg-purple-100 text-purple-600 rounded-xl font-medium hover:bg-purple-200 transition-all">ğŸ”„
                            æ¢ä¸€å¥—</button>
                        <button @click="saveAiOutfit"
                            class="px-5 py-2 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-xl font-medium hover:shadow-lg transition-all">ğŸ’¾
                            ä¿å­˜æ­¤æ­é…</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- OOTDè¯¦æƒ…å¼¹çª— -->
        <div v-if="showOotdDetailModal && currentOotd"
            class="fixed inset-0 z-[65] bg-black/50 flex items-center justify-center p-4"
            @click.self="showOotdDetailModal=false">
            <div class="glass-card w-full max-w-lg rounded-2xl shadow-2xl flex flex-col max-h-[90vh] animate-pop">
                <div class="p-4 border-b border-pink-100 flex justify-between items-center">
                    <h3 class="font-bold text-lg">{{ currentOotd.get('title') || 'ç©¿æ­è¯¦æƒ…' }}</h3>
                    <button @click="showOotdDetailModal=false"
                        class="text-2xl text-gray-400 hover:text-gray-600">&times;</button>
                </div>
                <div class="p-6 overflow-y-auto">
                    <p class="text-sm text-pink-500 font-medium mb-4">ğŸ“… {{ formatDate(currentOotd.get('date')) }}</p>

                    <!-- åŒ…å«çš„å•å“ -->
                    <h4 class="font-medium text-gray-700 mb-3">ä»Šæ—¥ç©¿æ­ ({{ (currentOotd.get('itemIds') || []).length }}ä»¶)
                    </h4>
                    <div class="grid grid-cols-3 gap-3 mb-4">
                        <div v-for="itemId in (currentOotd.get('itemIds') || [])" :key="itemId"
                            class="bg-white rounded-xl p-2 shadow-sm border cursor-pointer hover:shadow-md transition-all"
                            @click="openItemDetail(getItemById(itemId)); showOotdDetailModal=false">
                            <div class="aspect-square bg-gray-50 rounded-lg overflow-hidden mb-1">
                                <img v-if="getItemById(itemId)?.get('imageUrl')"
                                    :src="getItemById(itemId)?.get('imageUrl')" class="w-full h-full object-cover">
                                <span v-else
                                    class="flex items-center justify-center h-full text-2xl text-gray-300">ğŸ‘•</span>
                            </div>
                            <p class="text-xs text-center text-gray-500 truncate">{{
                                getItemById(itemId)?.get('category') }}</p>
                        </div>
                    </div>

                    <!-- å¤‡æ³¨ -->
                    <div v-if="currentOotd.get('note')" class="bg-gray-50 rounded-xl p-4">
                        <h4 class="font-medium text-gray-700 mb-2">å¿ƒæƒ…å¤‡æ³¨</h4>
                        <p class="text-sm text-gray-600">{{ currentOotd.get('note') }}</p>
                    </div>
                </div>
                <div class="p-4 border-t border-pink-100 flex justify-between">
                    <button @click="deleteOotd(currentOotd)"
                        class="px-4 py-2 text-red-500 hover:bg-red-50 rounded-xl transition-colors">
                        ğŸ—‘ï¸ åˆ é™¤
                    </button>
                    <div class="flex space-x-2">
                        <button @click="openAiTryOn('ootd', currentOotd)"
                            class="px-5 py-2 bg-indigo-50 text-indigo-600 rounded-xl font-medium hover:bg-indigo-100 transition-all">
                            ğŸ¤– AI è¯•ç©¿
                        </button>
                        <button @click="editOotd(currentOotd)"
                            class="px-5 py-2 bg-pink-50 text-pink-600 rounded-xl font-medium hover:bg-pink-100 transition-all">
                            âœï¸ ç¼–è¾‘
                        </button>
                        <button @click="showOotdDetailModal=false"
                            class="px-6 py-2 bg-gradient-to-r from-pink-500 to-rose-500 text-white rounded-xl font-medium hover:shadow-lg transition-all">
                            å…³é—­
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- æ·»åŠ OOTDå¼¹çª— -->
        <div v-if="showOotdModal" class="fixed inset-0 z-[60] bg-black/50 flex items-center justify-center p-4"
            @click.self="closeOotdModal">
            <div class="glass-card w-full max-w-2xl rounded-2xl shadow-2xl flex flex-col max-h-[90vh] animate-pop">
                <div class="p-4 border-b border-pink-100 flex justify-between items-center">
                    <h3 class="font-bold text-lg">{{ isEditingOotd ? 'ç¼–è¾‘ç©¿æ­' : 'è®°å½•ä»Šæ—¥ç©¿æ­' }}</h3>
                    <button @click="closeOotdModal" class="text-2xl text-gray-400 hover:text-gray-600">&times;</button>
                </div>
                <div class="p-6 overflow-y-auto space-y-4">
                    <!-- é€‰æ‹©ä»Šæ—¥ç©¿çš„è¡£ç‰© -->
                    <div class="bg-pink-50 rounded-xl p-4 border border-pink-100">
                        <div class="flex items-center justify-between mb-3">
                            <h4 class="font-bold text-pink-700 flex items-center"><span class="mr-2">ğŸ‘”</span>ä»Šæ—¥ç©¿äº†ä»€ä¹ˆ
                            </h4>
                            <span class="text-xs text-pink-500 font-medium">å·²é€‰ {{ ootdForm.selectedItems.length }}
                                ä»¶</span>
                        </div>
                        <!-- ç­›é€‰æ¡ä»¶ -->
                        <div class="flex flex-wrap gap-2 mb-3">
                            <select v-model="ootdPickerCategory"
                                class="px-3 py-1.5 border border-gray-200 rounded-lg text-sm bg-white focus:ring-2 focus:ring-pink-300 outline-none">
                                <option value="">å…¨éƒ¨åˆ†ç±»</option>
                                <option v-for="cat in categoryList" :key="cat.id" :value="cat.get('name')">
                                    {{ getCategoryIcon(cat.get('name')) }} {{ cat.get('name') }}
                                </option>
                            </select>
                        </div>
                        <!-- å¯é€‰è¡£ç‰©åˆ—è¡¨ -->
                        <div class="grid grid-cols-5 gap-2 max-h-40 overflow-y-auto">
                            <div v-for="item in filteredOotdPickerItems" :key="item.id" @click="toggleOotdItem(item)"
                                :class="ootdForm.selectedItems.includes(item.id) ? 'ring-2 ring-pink-500 bg-pink-50' : 'bg-white'"
                                class="rounded-lg overflow-hidden shadow-sm cursor-pointer transition-all hover:shadow-md relative">
                                <div class="aspect-square bg-gray-100 flex items-center justify-center overflow-hidden">
                                    <img v-if="item.get('imageUrl')" :src="item.get('imageUrl')"
                                        class="w-full h-full object-cover">
                                    <span v-else class="text-xl text-gray-300">ğŸ‘•</span>
                                </div>
                                <div v-if="ootdForm.selectedItems.includes(item.id)"
                                    class="absolute top-0.5 right-0.5 w-4 h-4 bg-pink-500 rounded-full flex items-center justify-center text-white text-xs">
                                    âœ“</div>
                            </div>
                        </div>
                        <!-- å·²é€‰é¢„è§ˆ -->
                        <div v-if="ootdForm.selectedItems.length > 0" class="mt-3 pt-3 border-t border-pink-200">
                            <p class="text-xs text-gray-500 mb-2">å·²é€‰å•å“ï¼š</p>
                            <div class="flex flex-wrap gap-2">
                                <div v-for="itemId in ootdForm.selectedItems" :key="itemId"
                                    class="flex items-center bg-white text-pink-700 px-2 py-1 rounded-full text-xs shadow-sm">
                                    <span>{{ getItemById(itemId)?.get('category') }}</span>
                                    <button @click.stop="toggleOotdItem(getItemById(itemId))"
                                        class="ml-1 text-pink-400 hover:text-pink-700">&times;</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="text-xs font-bold text-gray-500 block mb-2">æ—¥æœŸ</label>
                            <input v-model="ootdForm.date" type="date"
                                class="w-full p-3 border border-pink-200 rounded-xl focus:ring-2 focus:ring-pink-300 outline-none">
                        </div>
                        <div>
                            <label class="text-xs font-bold text-gray-500 block mb-2">æ ‡é¢˜</label>
                            <input v-model="ootdForm.title" placeholder="ä»Šæ—¥ç©¿æ­"
                                class="w-full p-3 border border-pink-200 rounded-xl focus:ring-2 focus:ring-pink-300 outline-none">
                        </div>
                    </div>
                    <div>
                        <label class="text-xs font-bold text-gray-500 block mb-2">å¿ƒæƒ…/å¤‡æ³¨</label>
                        <textarea v-model="ootdForm.note" placeholder="è®°å½•ä»Šå¤©çš„ç©¿æ­å¿ƒæƒ…..." rows="2"
                            class="w-full p-3 border border-pink-200 rounded-xl focus:ring-2 focus:ring-pink-300 outline-none resize-none"></textarea>
                    </div>
                </div>
                <div class="p-4 border-t border-pink-100 flex justify-end space-x-3">
                    <button @click="closeOotdModal"
                        class="px-5 py-2 text-gray-600 hover:bg-gray-100 rounded-xl transition-colors">å–æ¶ˆ</button>
                    <button @click="saveOotd" :disabled="isUploading || ootdForm.selectedItems.length === 0"
                        class="px-6 py-2 bg-gradient-to-r from-pink-500 to-rose-500 text-white rounded-xl font-medium hover:shadow-lg transition-all disabled:opacity-50">
                        ä¿å­˜ ({{ ootdForm.selectedItems.length }}ä»¶)</button>
                </div>
            </div>
        </div>

        <!-- AIè¯•ç©¿å¼¹çª— (IDM-VTON) -->
        <div v-if="showTryOnModal" class="fixed inset-0 z-[80] bg-black/50 flex items-center justify-center p-4"
            @click.self="showTryOnModal=false">
            <div class="glass-card w-full max-w-4xl rounded-2xl shadow-2xl flex flex-col max-h-[90vh] animate-pop">
                <div
                    class="p-4 border-b border-indigo-100 bg-gradient-to-r from-indigo-50 to-purple-50 rounded-t-2xl flex justify-between items-center">
                    <h3 class="font-bold text-lg text-indigo-700 flex items-center"><span class="mr-2">ğŸ‘—</span>AI è™šæ‹Ÿè¯•ç©¿
                        (IDM-VTON)</h3>
                    <button @click="showTryOnModal=false"
                        class="text-2xl text-gray-400 hover:text-gray-600">&times;</button>
                </div>

                <div class="p-6 overflow-y-auto grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- å·¦ä¾§ï¼šè¾“å…¥åŒºåŸŸ -->
                    <div class="space-y-4">
                        <!-- 1. æ¨¡ç‰¹å›¾ -->
                        <!-- 1. æ¨¡ç‰¹å›¾ -->
                        <div class="bg-gray-50 p-4 rounded-xl border border-gray-100">
                            <h4 class="font-bold text-gray-700 mb-2">1. é€‰æ‹©æ¨¡ç‰¹ (å¯ä¿å­˜)</h4>
                            <!-- Model Gallery -->
                            <div class="grid grid-cols-4 gap-2 mb-3 max-h-32 overflow-y-auto">
                                <div v-for="m in modelsList" :key="m.id"
                                    @click="tryOnModelImage = m.get('imageUrl'); tryOnModelFile=null;"
                                    class="aspect-[3/4] rounded-lg overflow-hidden border cursor-pointer relative"
                                    :class="tryOnModelImage === m.get('imageUrl') ? 'ring-2 ring-indigo-500' : 'border-gray-200'">
                                    <img :src="m.get('imageUrl')" class="w-full h-full object-cover">
                                    <button @click.stop="deleteModel(m)"
                                        class="absolute top-0 right-0 bg-red-500/80 text-white text-xs w-5 h-5 flex items-center justify-center hover:bg-red-600 rounded-bl-lg">&times;</button>
                                </div>
                                <label
                                    class="aspect-[3/4] border-2 border-dashed border-gray-300 rounded-lg flex flex-col items-center justify-center cursor-pointer hover:border-indigo-500 hover:text-indigo-500 bg-white transition-all">
                                    <span class="text-2xl font-light">+</span>
                                    <input type="file" accept="image/*" class="hidden"
                                        @change="(e) => uploadNewModel(e.target.files[0])">
                                </label>
                            </div>

                            <div
                                class="aspect-[3/4] bg-white rounded-lg overflow-hidden border border-gray-200 flex items-center justify-center relative shadow-inner">
                                <img v-if="tryOnModelImage" :src="tryOnModelImage" class="w-full h-full object-contain">
                                <div v-else class="text-gray-300 flex flex-col items-center">
                                    <span class="text-4xl mb-2">ğŸ‘¤</span>
                                    <span class="text-sm">è¯·é€‰æ‹©æˆ–ä¸Šä¼ æ¨¡ç‰¹</span>
                                </div>
                            </div>
                        </div>

                        <!-- 2. é€‰æ‹©è¡£ç‰© -->
                        <div class="bg-gray-50 p-4 rounded-xl border border-gray-100">
                            <h4 class="font-bold text-gray-700 mb-2">2. é€‰æ‹©è¯•ç©¿è¡£ç‰© (å¯å¤šé€‰)</h4>
                            <div class="grid grid-cols-4 gap-2 max-h-40 overflow-y-auto">
                                <div v-for="item in tryOnCandidateItems" :key="item.id" @click="selectTryOnItem(item)"
                                    :class="selectedTryOnItems.some(i => i.id === item.id) ? 'ring-2 ring-indigo-500 bg-indigo-50' : 'bg-white'"
                                    class="aspect-square rounded-lg overflow-hidden border cursor-pointer flex items-center justify-center relative">
                                    <img v-if="item.get('imageUrl')" :src="item.get('imageUrl')"
                                        class="w-full h-full object-cover">
                                    <span v-else class="text-lg">ğŸ‘•</span>
                                    <div v-if="selectedTryOnItems.some(i => i.id === item.id)"
                                        class="absolute inset-0 bg-indigo-500/20 flex items-center justify-center">
                                        <span class="text-white font-bold">{{ selectedTryOnItems.findIndex(i => i.id ===
                                            item.id) + 1 }}</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 3. è¡£ç‰©åˆ†ç±» -->
                        <div class="bg-gray-50 p-4 rounded-xl border border-gray-100 opacity-60 pointer-events-none">
                            <h4 class="font-bold text-gray-700 mb-2">3. è¡£ç‰©ç±»å‹ (è‡ªåŠ¨è¯†åˆ«)</h4>
                            <div class="flex gap-2">
                                <button v-for="cat in ['upper_body', 'lower_body', 'dresses']" :key="cat"
                                    @click="tryOnCategory = cat"
                                    :class="tryOnCategory === cat ? 'bg-indigo-500 text-white' : 'bg-white text-gray-600 border border-gray-200'"
                                    class="flex-1 py-1.5 rounded-lg text-sm transition-all">
                                    {{ cat === 'upper_body' ? 'ä¸Šè£…' : (cat === 'lower_body' ? 'ä¸‹è£…' : 'è¿è¡£è£™') }}
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- å³ä¾§ï¼šç»“æœåŒºåŸŸ -->
                    <div class="flex flex-col h-full">
                        <div
                            class="flex-1 bg-gray-900 rounded-xl overflow-hidden flex items-center justify-center relative min-h-[300px]">
                            <img v-if="tryOnResult" :src="tryOnResult" class="w-full h-full object-contain">

                            <!-- ç­‰å¾…çŠ¶æ€ -->
                            <div v-if="isTryOnProcessing"
                                class="absolute inset-0 bg-black/70 flex flex-col items-center justify-center text-white p-6 text-center z-10">
                                <div class="animate-spin text-4xl mb-4">â³</div>
                                <h3 class="text-xl font-bold mb-2">AI æ­£åœ¨ç”Ÿæˆè¯•ç©¿æ•ˆæœ...</h3>
                                <p class="text-gray-300 text-sm mb-4">æ­£åœ¨æ’é˜Ÿä¸­(Spaceå¯èƒ½è¾ƒæ…¢)ï¼Œè¯·è€å¿ƒç­‰å¾…ã€‚<br>è¯·å‹¿å…³é—­æ­¤çª—å£ã€‚</p>
                                <p v-if="tryOnStatus"
                                    class="bg-indigo-900/50 px-3 py-1 rounded-full text-xs border border-indigo-500/30 font-mono animate-pulse">
                                    {{ tryOnStatus }}
                                </p>
                            </div>

                            <div v-else-if="!tryOnResult" class="text-gray-500 flex flex-col items-center">
                                <span class="text-6xl mb-4">âœ¨</span>
                                <p>ç‚¹å‡»"å¼€å§‹è¯•ç©¿"ç”Ÿæˆæ•ˆæœ</p>
                            </div>
                        </div>

                        <div class="mt-4 flex gap-3">
                            <button @click="generateTryOn" :disabled="!canTryOn || isTryOnProcessing"
                                class="flex-1 bg-gradient-to-r from-indigo-500 to-purple-500 text-white py-3 rounded-xl font-bold shadow-lg hover:shadow-indigo-500/30 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center">
                                <span v-if="isTryOnProcessing">ç”Ÿæˆä¸­...</span>
                                <span v-else>ğŸš€ å¼€å§‹è¯•ç©¿</span>
                            </button>
                            <button v-if="tryOnResult && !isTryOnProcessing" @click="saveTryOnResult"
                                class="flex-1 bg-green-500 text-white py-3 rounded-xl font-bold shadow-lg hover:bg-green-600 transition-all">
                                ğŸ’¾ è®¾ä¸ºå°é¢
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- å•å“è¯¦æƒ…å¼¹çª— -->
        <div v-if="showItemDetailModal && currentItem"
            class="fixed inset-0 z-[60] bg-black/50 flex items-center justify-center p-4"
            @click.self="showItemDetailModal=false">
            <div class="glass-card w-full max-w-lg rounded-2xl shadow-2xl flex flex-col max-h-[90vh] animate-pop">
                <div class="p-4 border-b border-pink-100 flex justify-between items-center">
                    <h3 class="font-bold text-lg">å•å“è¯¦æƒ…</h3>
                    <button @click="showItemDetailModal=false"
                        class="text-2xl text-gray-400 hover:text-gray-600">&times;</button>
                </div>
                <div class="p-6 overflow-y-auto">
                    <div v-if="currentItem.get('imageUrl')"
                        class="aspect-square bg-gray-50 rounded-2xl overflow-hidden mb-4">
                        <img :src="currentItem.get('imageUrl')" class="w-full h-full object-cover" alt="">
                    </div>
                    <div class="space-y-3">
                        <div class="flex justify-between"><span class="text-gray-500">åˆ†ç±»</span><span
                                class="font-medium">{{
                                currentItem.get('category') }}</span></div>
                        <div class="flex justify-between"><span class="text-gray-500">ä»·æ ¼</span><span
                                class="font-medium text-pink-500">Â¥{{ currentItem.get('price') || 0 }}</span></div>
                        <div class="flex justify-between"><span class="text-gray-500">å“ç‰Œ</span><span
                                class="font-medium">{{
                                currentItem.get('brand') || '-' }}</span></div>
                        <div class="flex justify-between"><span class="text-gray-500">ç©¿ç€æ¬¡æ•°</span><span
                                class="font-medium">{{ currentItem.get('wearCount') || 0 }}æ¬¡</span></div>
                        <div v-if="currentItem.get('note')"><span class="text-gray-500 block mb-1">å¤‡æ³¨</span>
                            <p class="text-sm bg-gray-50 p-3 rounded-xl">{{ currentItem.get('note') }}</p>
                        </div>
                    </div>
                </div>
                <div class="p-4 border-t border-pink-100 flex justify-between">
                    <button @click="deleteItem(currentItem)"
                        class="px-4 py-2 text-rose-500 hover:bg-rose-50 rounded-xl transition-colors">åˆ é™¤</button>
                    <div class="flex space-x-3">
                        <button @click="wearItem(currentItem)"
                            class="px-4 py-2 bg-green-50 text-green-600 rounded-xl font-medium hover:bg-green-100 transition-all">ğŸ‘•
                            ä»Šæ—¥ç©¿äº†</button>
                        <button @click="editItem(currentItem)"
                            class="px-4 py-2 bg-pink-50 text-pink-600 rounded-xl font-medium hover:bg-pink-100 transition-all">ç¼–è¾‘</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const { createApp, ref, reactive, onMounted, computed, watch } = Vue;

        createApp({
            setup() {
                const isReady = ref(false);
                const hasConfig = ref(false);
                const currentUser = ref(null);
                const currentView = ref('closet');
                const isUploading = ref(false);

                const items = ref([]);
                const outfits = ref([]);
                const ootdList = ref([]);
                const categoryList = ref([]);
                const closetFilters = ref([]);
                const newCategoryName = ref('');

                const tempUploadedFiles = ref([]);

                // å¼¹çª—çŠ¶æ€
                const showItemModal = ref(false);
                const showOutfitModal = ref(false);
                const showOotdModal = ref(false);
                const showItemDetailModal = ref(false);
                const showAiResultModal = ref(false);
                const showCategoryDetailModal = ref(false);
                const showOutfitDetailModal = ref(false);
                const showOotdDetailModal = ref(false);
                const currentOutfit = ref(null);
                const currentOotd = ref(null);

                // åˆ†ç±»è¯¦æƒ…ç­›é€‰
                const categoryDetailName = ref('');
                const categoryDetailSort = ref('newest');
                const categoryDetailMinPrice = ref(null);
                const categoryDetailMaxPrice = ref(null);
                const categoryDetailMinWear = ref(null);
                const categoryDetailMaxWear = ref(null);

                // æœç´¢
                const outfitSearchKeyword = ref('');
                const ootdSearchKeyword = ref('');

                // OOTDç­›é€‰
                const ootdDateFrom = ref('');
                const ootdDateTo = ref('');
                const ootdPickerCategory = ref('');


                const isEditingItem = ref(false);
                const isEditingOutfit = ref(false);
                const isEditingOotd = ref(false);
                const editingObject = ref(null);
                const currentItem = ref(null);

                // AIç›¸å…³
                const aiKeyInput = ref('');
                const hasAiKey = ref(false);
                const isAiGenerating = ref(false);
                const aiSelectedCategories = ref([]);
                const aiResult = reactive({ items: [], reason: '' });

                // AIè¯•ç©¿ç›¸å…³
                const hfTokenInput = ref('');
                const hasHfToken = ref(false);
                const customSpaceIdInput = ref('');
                const hasCustomSpace = ref(false);
                const showTryOnModal = ref(false);
                const tryOnModelImage = ref('');
                const tryOnModelFile = ref(null);
                const selectedTryOnItem = ref(null); // Deprecated but kept
                const selectedTryOnItems = ref([]);
                const tryOnCategory = ref('upper_body');
                const tryOnResult = ref('');
                const isTryOnProcessing = ref(false);
                const tryOnStatus = ref('');
                const tryOnCandidateItems = ref([]);
                const modelsList = ref([]);
                const currentTryOnSource = ref(null);
                const currentTryOnObject = ref(null);
                const canTryOn = computed(() => tryOnModelImage.value && selectedTryOnItems.value.length > 0 && !isTryOnProcessing.value);

                // è¡¨å•
                const configForm = reactive({ appId: '', appKey: '', serverURL: '' });
                const authMode = ref('login');
                const authForm = reactive({ username: '', password: '' });
                const itemForm = reactive({ imageUrl: '', category: '', price: 0, brand: '', note: '' });
                const outfitForm = reactive({ imageUrl: '', name: '', note: '', selectedItems: [] });
                const ootdForm = reactive({ imageUrl: '', date: new Date().toISOString().split('T')[0], title: '', note: '', selectedItems: [] });

                // è¡£ç‰©é€‰æ‹©å™¨
                const outfitPickerCategory = ref('');
                const outfitPickerSort = ref('newest');
                const outfitPickerMaxPrice = ref(null);

                // ç»Ÿè®¡æ•°æ®
                const totalItems = computed(() => items.value.length);
                const totalValue = computed(() => items.value.reduce((sum, item) => sum + (item.get('price') || 0), 0));
                const totalOutfits = computed(() => outfits.value.length);
                const totalOotd = computed(() => ootdList.value.length);

                const currentViewTitle = computed(() => ({
                    'closet': 'å…¨éƒ¨å•å“',
                    'outfits': 'æˆ‘çš„æ­é…',
                    'ootd': 'ç©¿æ­æ—¥è®°',
                    'profile': 'æˆ‘çš„'
                }[currentView.value]));

                const getCategoryCount = (catName) => items.value.filter(i => i.get('category') === catName).length;

                const toggleClosetFilter = (catName) => {
                    const idx = closetFilters.value.indexOf(catName);
                    if (idx === -1) closetFilters.value.push(catName);
                    else closetFilters.value.splice(idx, 1);
                };

                const displayCategories = computed(() => {
                    const filtered = closetFilters.value.length > 0
                        ? items.value.filter(i => closetFilters.value.includes(i.get('category')))
                        : items.value;
                    const groups = {};
                    filtered.forEach(item => {
                        const cat = item.get('category') || 'æœªåˆ†ç±»';
                        if (!groups[cat]) groups[cat] = [];
                        groups[cat].push(item);
                    });
                    return Object.keys(groups).map(name => ({ name, items: groups[name], count: groups[name].length }));
                });

                // åˆ†ç±»è¯¦æƒ…åŠŸèƒ½
                const openCategoryDetail = (catName) => {
                    categoryDetailName.value = catName;
                    categoryDetailSort.value = 'newest';
                    categoryDetailMinPrice.value = null;
                    categoryDetailMaxPrice.value = null;
                    categoryDetailMinWear.value = null;
                    categoryDetailMaxWear.value = null;
                    showCategoryDetailModal.value = true;
                };
                const resetCategoryDetailFilters = () => {
                    categoryDetailSort.value = 'newest';
                    categoryDetailMinPrice.value = null;
                    categoryDetailMaxPrice.value = null;
                    categoryDetailMinWear.value = null;
                    categoryDetailMaxWear.value = null;
                };
                const filteredCategoryItems = computed(() => {
                    let result = items.value.filter(i => i.get('category') === categoryDetailName.value);
                    // ä»·æ ¼ç­›é€‰
                    if (categoryDetailMinPrice.value !== null && categoryDetailMinPrice.value >= 0) {
                        result = result.filter(i => (i.get('price') || 0) >= categoryDetailMinPrice.value);
                    }
                    if (categoryDetailMaxPrice.value !== null && categoryDetailMaxPrice.value >= 0) {
                        result = result.filter(i => (i.get('price') || 0) <= categoryDetailMaxPrice.value);
                    }
                    // ç©¿ç€æ¬¡æ•°ç­›é€‰
                    if (categoryDetailMinWear.value !== null && categoryDetailMinWear.value >= 0) {
                        result = result.filter(i => (i.get('wearCount') || 0) >= categoryDetailMinWear.value);
                    }
                    if (categoryDetailMaxWear.value !== null && categoryDetailMaxWear.value >= 0) {
                        result = result.filter(i => (i.get('wearCount') || 0) <= categoryDetailMaxWear.value);
                    }
                    // æ’åº
                    switch (categoryDetailSort.value) {
                        case 'price_asc':
                            result.sort((a, b) => (a.get('price') || 0) - (b.get('price') || 0));
                            break;
                        case 'price_desc':
                            result.sort((a, b) => (b.get('price') || 0) - (a.get('price') || 0));
                            break;
                        case 'wear_asc':
                            result.sort((a, b) => (a.get('wearCount') || 0) - (b.get('wearCount') || 0));
                            break;
                        case 'wear_desc':
                            result.sort((a, b) => (b.get('wearCount') || 0) - (a.get('wearCount') || 0));
                            break;
                        default:
                            result.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
                    }
                    return result;
                });

                // è¡£ç‰©é€‰æ‹©å™¨ç­›é€‰
                const filteredPickerItems = computed(() => {
                    let result = [...items.value];
                    // åˆ†ç±»ç­›é€‰
                    if (outfitPickerCategory.value) {
                        result = result.filter(i => i.get('category') === outfitPickerCategory.value);
                    }
                    // ä»·æ ¼ç­›é€‰
                    if (outfitPickerMaxPrice.value && outfitPickerMaxPrice.value > 0) {
                        result = result.filter(i => (i.get('price') || 0) <= outfitPickerMaxPrice.value);
                    }
                    // æ’åº
                    switch (outfitPickerSort.value) {
                        case 'price_asc':
                            result.sort((a, b) => (a.get('price') || 0) - (b.get('price') || 0));
                            break;
                        case 'price_desc':
                            result.sort((a, b) => (b.get('price') || 0) - (a.get('price') || 0));
                            break;
                        case 'wear_asc':
                            result.sort((a, b) => (a.get('wearCount') || 0) - (b.get('wearCount') || 0));
                            break;
                        case 'wear_desc':
                            result.sort((a, b) => (b.get('wearCount') || 0) - (a.get('wearCount') || 0));
                            break;
                        default: // newest
                            result.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
                    }
                    return result;
                });

                const getItemById = (id) => items.value.find(i => i.id === id);
                const toggleOutfitItem = (item) => {
                    if (!item) return;
                    const idx = outfitForm.selectedItems.indexOf(item.id);
                    if (idx === -1) outfitForm.selectedItems.push(item.id);
                    else outfitForm.selectedItems.splice(idx, 1);
                };

                // æ­é…æœç´¢ç­›é€‰
                const filteredOutfits = computed(() => {
                    if (!outfitSearchKeyword.value) return outfits.value;
                    const kw = outfitSearchKeyword.value.toLowerCase();
                    return outfits.value.filter(o => {
                        const name = (o.get('name') || '').toLowerCase();
                        const note = (o.get('note') || '').toLowerCase();
                        return name.includes(kw) || note.includes(kw);
                    });
                });

                // OOTDç­›é€‰
                const filteredOotdList = computed(() => {
                    let result = [...ootdList.value];
                    // å…³é”®è¯ç­›é€‰
                    if (ootdSearchKeyword.value) {
                        const kw = ootdSearchKeyword.value.toLowerCase();
                        result = result.filter(o => {
                            const title = (o.get('title') || '').toLowerCase();
                            const note = (o.get('note') || '').toLowerCase();
                            return title.includes(kw) || note.includes(kw);
                        });
                    }
                    // æ—¥æœŸç­›é€‰
                    if (ootdDateFrom.value) {
                        result = result.filter(o => o.get('date') >= ootdDateFrom.value);
                    }
                    if (ootdDateTo.value) {
                        result = result.filter(o => o.get('date') <= ootdDateTo.value);
                    }
                    return result;
                });

                const filteredOotdPickerItems = computed(() => {
                    if (!ootdPickerCategory.value) return items.value;
                    return items.value.filter(i => i.get('category') === ootdPickerCategory.value);
                });

                const toggleOotdItem = (item) => {
                    if (!item) return;
                    const idx = ootdForm.selectedItems.indexOf(item.id);
                    if (idx === -1) ootdForm.selectedItems.push(item.id);
                    else ootdForm.selectedItems.splice(idx, 1);
                };


                onMounted(() => {
                    const storedId = localStorage.getItem('lc_app_id');
                    const storedKey = localStorage.getItem('lc_app_key');
                    const storedUrl = localStorage.getItem('lc_server_url');
                    if (storedId && storedKey && storedUrl) {
                        configForm.appId = storedId; configForm.appKey = storedKey; configForm.serverURL = storedUrl;
                        initLeanCloud(storedId, storedKey, storedUrl);
                    } else { isReady.value = true; }
                });

                const initLeanCloud = (id, key, url) => {
                    try {
                        AV.init({ appId: id, appKey: key, serverURLs: url });
                        hasConfig.value = true;
                        currentUser.value = AV.User.current();
                        isReady.value = true;
                        if (currentUser.value) loadAllData();
                    } catch (error) { console.error(error); alert('é…ç½®é”™è¯¯'); clearConfig(); }
                };

                const saveConfig = () => { localStorage.setItem('lc_app_id', configForm.appId); localStorage.setItem('lc_app_key', configForm.appKey); localStorage.setItem('lc_server_url', configForm.serverURL); initLeanCloud(configForm.appId, configForm.appKey, configForm.serverURL); };
                const clearConfig = () => { localStorage.removeItem('lc_app_id'); localStorage.removeItem('lc_app_key'); localStorage.removeItem('lc_server_url'); hasConfig.value = false; isReady.value = false; location.reload(); };

                const handleAuth = async () => {
                    try {
                        if (authMode.value === 'login') await AV.User.logIn(authForm.username, authForm.password);
                        else { const user = new AV.User(); user.setUsername(authForm.username); user.setPassword(authForm.password); await user.signUp(); }
                        currentUser.value = AV.User.current(); loadAllData();
                    } catch (e) { alert('è®¤è¯å¤±è´¥: ' + e.message); }
                };
                const handleLogout = () => { AV.User.logOut(); currentUser.value = null; items.value = []; outfits.value = []; ootdList.value = []; };

                const loadAllData = () => { loadCategories(); loadItems(); loadOutfits(); loadOotd(); };
                const loadCategories = async () => { const q = new AV.Query('WardrobeCategory'); q.equalTo('owner', currentUser.value); categoryList.value = await q.find(); };
                const loadItems = async () => { const q = new AV.Query('WardrobeItem'); q.equalTo('owner', currentUser.value); q.descending('createdAt'); q.limit(1000); items.value = await q.find(); };
                const loadOutfits = async () => { const q = new AV.Query('WardrobeOutfit'); q.equalTo('owner', currentUser.value); q.descending('createdAt'); q.limit(1000); outfits.value = await q.find(); };
                const loadOotd = async () => { const q = new AV.Query('WardrobeOOTD'); q.equalTo('owner', currentUser.value); q.descending('date'); q.limit(1000); ootdList.value = await q.find(); };

                const addCategory = async () => {
                    const val = newCategoryName.value.trim();
                    if (!val) return alert('è¯·è¾“å…¥åˆ†ç±»åç§°');
                    if (categoryList.value.some(c => c.get('name') === val)) return alert('åˆ†ç±»å·²å­˜åœ¨');
                    const c = new AV.Object('WardrobeCategory'); c.set('name', val); c.set('owner', currentUser.value); c.setACL(new AV.ACL(currentUser.value));
                    await c.save(); newCategoryName.value = ''; loadCategories();
                };
                const removeCategory = async (c) => { if (confirm('ç¡®è®¤åˆ é™¤æ­¤åˆ†ç±»?')) { await c.destroy(); loadCategories(); } };

                const getCategoryIcon = (name) => {
                    const icons = { 'è£¤å­': 'ğŸ‘–', 'åŠèº«è£™': 'ğŸ©±', 'ä¸Šè¡£': 'ğŸ‘•', 'å¤–å¥—': 'ğŸ§¥', 'è¿è¡£è£™': 'ğŸ‘—', 'é‹å­': 'ğŸ‘Ÿ', 'åŒ…åŒ…': 'ğŸ‘œ', 'é…é¥°': 'ğŸ’' };
                    return icons[name] || 'ğŸ‘š';
                };

                // å›¾ç‰‡ä¸Šä¼ 
                const uploadFileToLeanCloud = async (file) => {
                    const avFile = new AV.File(file.name, file);
                    const savedFile = await avFile.save();
                    tempUploadedFiles.value.push(savedFile);
                    return savedFile.url();
                };

                const deleteFileByUrl = async (url) => {
                    if (!url) return;
                    try {
                        const cleanUrl = url.split('?')[0];
                        const parts = cleanUrl.split('/');
                        const hashPart = parts.find(part => /^[a-zA-Z0-9]{24,35}$/.test(part));
                        if (hashPart) {
                            const q = new AV.Query('_File');
                            q.equalTo('key', hashPart);
                            const files = await q.find();
                            if (files.length > 0) await AV.Object.destroyAll(files);
                        }
                    } catch (e) { console.warn('åˆ é™¤å›¾ç‰‡å¤±è´¥:', e); }
                };

                // å•å“æ“ä½œ
                const openAddItemModal = () => { isEditingItem.value = false; editingObject.value = null; Object.assign(itemForm, { imageUrl: '', category: '', price: 0, brand: '', note: '' }); tempUploadedFiles.value = []; showItemModal.value = true; };
                const handleItemImageUpload = async (e) => {
                    const file = e.target.files[0]; if (!file) return;
                    if (file.size > 5 * 1024 * 1024) { alert('å›¾ç‰‡ä¸èƒ½è¶…è¿‡5MB'); return; }
                    isUploading.value = true;
                    try { itemForm.imageUrl = await uploadFileToLeanCloud(file); } catch (err) { alert('ä¸Šä¼ å¤±è´¥'); }
                    finally { isUploading.value = false; e.target.value = ''; }
                };
                const removeItemImage = async () => { if (itemForm.imageUrl && !isEditingItem.value) { await deleteFileByUrl(itemForm.imageUrl); } itemForm.imageUrl = ''; };
                const closeItemModal = async () => {
                    // å¦‚æœæ˜¯æ–°å»ºæ¨¡å¼ä¸”æœ‰ä¸´æ—¶ä¸Šä¼ çš„æ–‡ä»¶ï¼Œåˆ é™¤å®ƒä»¬
                    if (!isEditingItem.value && tempUploadedFiles.value.length > 0) {
                        for (const f of tempUploadedFiles.value) {
                            try { await f.destroy(); } catch (e) { console.warn('æ¸…ç†ä¸´æ—¶æ–‡ä»¶å¤±è´¥:', e); }
                        }
                    }
                    tempUploadedFiles.value = [];
                    showItemModal.value = false;
                };
                const saveItem = async () => {
                    if (!itemForm.category) return alert('è¯·é€‰æ‹©åˆ†ç±»');
                    const ObjClass = AV.Object.extend('WardrobeItem');
                    const obj = isEditingItem.value ? editingObject.value : new ObjClass();
                    if (!isEditingItem.value) { obj.set('owner', currentUser.value); obj.setACL(new AV.ACL(currentUser.value)); obj.set('wearCount', 0); }
                    obj.set('imageUrl', itemForm.imageUrl);
                    obj.set('category', itemForm.category);
                    obj.set('price', itemForm.price || 0);
                    obj.set('brand', itemForm.brand);
                    obj.set('note', itemForm.note);
                    try { await obj.save(); tempUploadedFiles.value = []; showItemModal.value = false; loadItems(); } catch (e) { alert('ä¿å­˜å¤±è´¥: ' + e.message); }
                };
                const openItemDetail = (item) => { currentItem.value = item; showItemDetailModal.value = true; };
                const editItem = (item) => { showItemDetailModal.value = false; isEditingItem.value = true; editingObject.value = item; Object.assign(itemForm, { imageUrl: item.get('imageUrl') || '', category: item.get('category') || '', price: item.get('price') || 0, brand: item.get('brand') || '', note: item.get('note') || '' }); tempUploadedFiles.value = []; showItemModal.value = true; };
                const deleteItem = async (item) => { if (confirm('ç¡®è®¤åˆ é™¤æ­¤å•å“?')) { await deleteFileByUrl(item.get('imageUrl')); await item.destroy(); showItemDetailModal.value = false; loadItems(); } };
                const wearItem = async (item) => { item.increment('wearCount', 1); await item.save(); showItemDetailModal.value = false; loadItems(); alert('å·²è®°å½•ç©¿ç€!'); };

                // æ­é…æ“ä½œ
                const openAddOutfitModal = () => {
                    isEditingOutfit.value = false;
                    editingObject.value = null;
                    Object.assign(outfitForm, { imageUrl: '', name: '', note: '', selectedItems: [] });
                    aiSelectedCategories.value = [];
                    outfitPickerCategory.value = '';
                    outfitPickerSort.value = 'newest';
                    outfitPickerMaxPrice.value = null;
                    tempUploadedFiles.value = [];
                    showOutfitModal.value = true;
                };
                const handleOutfitImageUpload = async (e) => { const file = e.target.files[0]; if (!file) return; if (file.size > 5 * 1024 * 1024) { alert('å›¾ç‰‡ä¸èƒ½è¶…è¿‡5MB'); return; } isUploading.value = true; try { outfitForm.imageUrl = await uploadFileToLeanCloud(file); } catch (err) { alert('ä¸Šä¼ å¤±è´¥'); } finally { isUploading.value = false; e.target.value = ''; } };
                const removeOutfitImage = async () => { if (outfitForm.imageUrl && !isEditingOutfit.value) { await deleteFileByUrl(outfitForm.imageUrl); } outfitForm.imageUrl = ''; };
                const closeOutfitModal = async () => {
                    // å¦‚æœæ˜¯æ–°å»ºæ¨¡å¼ä¸”æœ‰ä¸´æ—¶ä¸Šä¼ çš„æ–‡ä»¶ï¼Œåˆ é™¤å®ƒä»¬
                    if (!isEditingOutfit.value && tempUploadedFiles.value.length > 0) {
                        for (const f of tempUploadedFiles.value) {
                            try { await f.destroy(); } catch (e) { console.warn('æ¸…ç†ä¸´æ—¶æ–‡ä»¶å¤±è´¥:', e); }
                        }
                    }
                    tempUploadedFiles.value = [];
                    showOutfitModal.value = false;
                };
                const saveOutfit = async () => {
                    if (outfitForm.selectedItems.length === 0) return alert('è¯·è‡³å°‘é€‰æ‹©ä¸€ä»¶è¡£ç‰©');
                    const ObjClass = AV.Object.extend('WardrobeOutfit');
                    const obj = isEditingOutfit.value ? editingObject.value : new ObjClass();
                    if (!isEditingOutfit.value) {
                        obj.set('owner', currentUser.value);
                        obj.setACL(new AV.ACL(currentUser.value));
                    }
                    obj.set('imageUrl', outfitForm.imageUrl);
                    obj.set('name', outfitForm.name || 'æˆ‘çš„æ­é…-' + new Date().toLocaleDateString('zh-CN'));
                    obj.set('note', outfitForm.note);
                    obj.set('itemIds', outfitForm.selectedItems);
                    try {
                        await obj.save();
                        tempUploadedFiles.value = [];
                        showOutfitModal.value = false;
                        loadOutfits();
                        alert('æ­é…å·²ä¿å­˜ï¼');
                    } catch (e) { alert('ä¿å­˜å¤±è´¥: ' + e.message); }
                };
                const openOutfitDetail = (outfit) => {
                    currentOutfit.value = outfit;
                    showOutfitDetailModal.value = true;
                };
                const deleteOutfit = async (outfit) => {
                    if (confirm('ç¡®è®¤åˆ é™¤æ­¤æ­é…ï¼Ÿ')) {
                        try {
                            await outfit.destroy();
                            showOutfitDetailModal.value = false;
                            loadOutfits();
                        } catch (e) { alert('åˆ é™¤å¤±è´¥: ' + e.message); }
                    }
                };
                const editOutfit = (outfit) => {
                    showOutfitDetailModal.value = false;
                    isEditingOutfit.value = true;
                    editingObject.value = outfit;
                    Object.assign(outfitForm, {
                        imageUrl: outfit.get('imageUrl') || '',
                        name: outfit.get('name') || '',
                        note: outfit.get('note') || '',
                        selectedItems: [...(outfit.get('itemIds') || [])]
                    });
                    outfitPickerCategory.value = '';
                    outfitPickerSort.value = 'newest';
                    outfitPickerMaxPrice.value = null;
                    tempUploadedFiles.value = [];
                    showOutfitModal.value = true;
                };

                // AIè¯•ç©¿åŠŸèƒ½çš„æ–¹æ³•
                const saveHfToken = () => {
                    if (!hfTokenInput.value.trim()) return alert('è¯·è¾“å…¥ HF Token');
                    localStorage.setItem('lc_hf_token', hfTokenInput.value.trim());
                    hasHfToken.value = true;
                    alert('HF Token ä¿å­˜æˆåŠŸï¼');
                };

                const saveCustomSpace = () => {
                    if (!customSpaceIdInput.value.trim()) {
                        localStorage.removeItem('lc_hf_space_id');
                        hasCustomSpace.value = false;
                        alert('å·²åœ¨è®¾ç½®é‡ç½®ä¸ºé»˜è®¤ Space');
                        return;
                    }
                    localStorage.setItem('lc_hf_space_id', customSpaceIdInput.value.trim());
                    hasCustomSpace.value = true;
                    alert('Space ID é…ç½®æˆåŠŸï¼ä¸‹ä¸€æ¬¡è¯•ç©¿å°†ä¼˜å…ˆä½¿ç”¨æ­¤èŠ‚ç‚¹ã€‚');
                };

                const loadModels = async () => {
                    try {
                        const query = new AV.Query('WardrobeModel');
                        query.equalTo('owner', currentUser.value);
                        query.descending('createdAt');
                        modelsList.value = await query.find();
                    } catch (e) { console.error('Load models failed', e); }
                };

                const uploadNewModel = async (file) => {
                    if (!file) return;
                    isUploading.value = true;
                    try {
                        const url = await uploadFileToLeanCloud(file);
                        const ModelClass = AV.Object.extend('WardrobeModel');
                        const m = new ModelClass();
                        m.set('owner', currentUser.value);
                        m.set('imageUrl', url);
                        const acl = new AV.ACL(currentUser.value);
                        acl.setPublicReadAccess(true);
                        m.setACL(acl);
                        await m.save();
                        await loadModels();
                        tryOnModelImage.value = m.get('imageUrl');
                        tryOnModelFile.value = null;
                    } catch (e) { alert('ä¸Šä¼ æ¨¡ç‰¹å¤±è´¥: ' + e.message); }
                    finally { isUploading.value = false; }
                };

                const deleteModel = async (model) => {
                    if (!confirm('åˆ é™¤æ­¤æ¨¡ç‰¹å›¾ï¼Ÿ')) return;
                    try {
                        await model.destroy();
                        await loadModels();
                        if (tryOnModelImage.value === model.get('imageUrl')) tryOnModelImage.value = '';
                    } catch (e) { alert('åˆ é™¤å¤±è´¥: ' + e.message); }
                };

                // Helper for category mapping
                const getVtonCategory = (cat) => {
                    if (['è¿è¡£è£™', 'è£™å­', 'ç¤¼æœ'].includes(cat)) return 'dresses';
                    if (['è£¤å­', 'åŠèº«è£™', 'çŸ­è£¤', 'ç‰›ä»”è£¤'].includes(cat)) return 'lower_body';
                    return 'upper_body';
                };

                const openAiTryOn = (type, obj) => { // type: 'outfit' | 'ootd'
                    currentTryOnSource.value = type;
                    currentTryOnObject.value = obj;

                    // Reset state
                    tryOnResult.value = '';
                    isTryOnProcessing.value = false;
                    tryOnStatus.value = '';
                    selectedTryOnItems.value = [];

                    // Determine candidate items
                    let itemIds = obj.get('itemIds') || [];
                    const candidates = itemIds.map(id => getItemById(id)).filter(Boolean);
                    tryOnCandidateItems.value = candidates;

                    // Auto-select ALL valid candidates
                    const mainItems = candidates.filter(i => {
                        const cat = i.get('category');
                        return ['ä¸Šè¡£', 'å¤–å¥—', 'Tæ¤', 'è¡¬è¡«', 'æ¯›è¡£', 'è£¤å­', 'åŠèº«è£™', 'è¿è¡£è£™'].some(c => cat.includes(c));
                    });

                    selectedTryOnItems.value = mainItems.length > 0 ? mainItems : candidates;
                    showTryOnModal.value = true;
                    loadModels();
                };

                const selectTryOnItem = (item) => {
                    const idx = selectedTryOnItems.value.findIndex(i => i.id === item.id);
                    if (idx > -1) selectedTryOnItems.value.splice(idx, 1);
                    else selectedTryOnItems.value.push(item);
                };

                const generateTryOn = async () => {
                    if (!tryOnModelImage.value || selectedTryOnItems.value.length === 0) return alert('è¯·é€‰æ‹©æ¨¡ç‰¹å›¾å’Œè‡³å°‘ä¸€ä»¶è¡£ç‰©');

                    isTryOnProcessing.value = true;
                    tryOnStatus.value = "æ­£åœ¨åˆå§‹åŒ– Client...";

                    try {
                        const module = await import('https://cdn.jsdelivr.net/npm/@gradio/client/+esm');
                        const Client = module.Client || module.client || module.default.Client;
                        console.log("Gradio Client loaded:", Client); // Debug
                        const token = localStorage.getItem('lc_hf_token');
                        const options = token ? { hf_token: token } : {};

                        tryOnStatus.value = "æ­£åœ¨è¿æ¥ Space...";

                        const connectWithFailover = async (Client, options) => {
                            const savedCustom = localStorage.getItem('lc_hf_space_id');
                            // Fallback list (Prioritize robust mirrors)
                            const candidates = savedCustom ? [savedCustom] : [
                                'yisol/IDM-VTON',
                                'skivap/IDM-VTON',
                                'kwai-kolors/Kolors-Virtual-Try-On',
                                'virajw/idm-vton',
                                'human-ai/idm-vton',
                                'Nymbo/Virtual-Try-On'
                            ];

                            const hasToken = !!options.hf_token;

                            for (const spaceId of candidates) {
                                // 1. Try with Token (if configured)
                                if (hasToken) {
                                    tryOnStatus.value = `æ­£åœ¨è¿æ¥ ${spaceId} (éªŒè¯Token)...`;
                                    try {
                                        return await Client.connect(spaceId, options);
                                    } catch (e) {
                                        console.warn(`${spaceId} Token connect failed`, e);
                                        tryOnStatus.value = `Token éªŒè¯å¤±è´¥ï¼Œå°è¯•åŒ¿åè¿æ¥...`;
                                    }
                                }

                                // 2. Try Anonymous (No token)
                                try {
                                    tryOnStatus.value = `æ­£åœ¨è¿æ¥ ${spaceId} (åŒ¿åæ¨¡å¼)...`;
                                    return await Client.connect(spaceId, {});
                                } catch (e) {
                                    console.warn(`${spaceId} Anonymous connect failed`, e);
                                    if (candidates.length > 1) tryOnStatus.value = `${spaceId} å¤±è´¥ï¼Œåˆ‡æ¢ä¸‹ä¸€èŠ‚ç‚¹...`;
                                }

                                // Small delay before next candidate
                                await new Promise(r => setTimeout(r, 1000));
                            }

                            let errorMsg = "è¿æ¥å¤±è´¥ï¼Œæ— æ³•è¿æ¥åˆ° AI æœåŠ¡ã€‚";
                            if (window.location.protocol === 'file:') {
                                errorMsg += " ç”±äºæµè§ˆå™¨å®‰å…¨é™åˆ¶ï¼Œç›´æ¥æ‰“å¼€ HTML æ–‡ä»¶å¯èƒ½å—é˜»ã€‚å»ºè®®ä½¿ç”¨ 'Live Server' æˆ–æœ¬åœ°æœåŠ¡å™¨è¿è¡Œã€‚";
                            } else {
                                errorMsg += " è¯·æ£€æŸ¥ VPN è¿é€šæ€§æˆ–ç¨åå†è¯•ã€‚";
                            }
                            throw new Error(errorMsg);
                        };

                        const app = await connectWithFailover(Client, options);

                        let currentPersonImageBlob;
                        if (tryOnModelFile.value) {
                            currentPersonImageBlob = tryOnModelFile.value;
                        } else {
                            // Fix Mixed Content: Force HTTPS
                            const secureUrl = tryOnModelImage.value.replace(/^http:\/\//, 'https://');
                            currentPersonImageBlob = await (await fetch(secureUrl)).blob();
                        }

                        const itemsToProcess = [...selectedTryOnItems.value];

                        for (let i = 0; i < itemsToProcess.length; i++) {
                            const item = itemsToProcess[i];
                            const itemCat = getVtonCategory(item.get('category'));

                            tryOnStatus.value = `æ­£åœ¨å¤„ç†ç¬¬ ${i + 1}/${itemsToProcess.length} ä»¶: ${item.get('category')}... (æ’é˜Ÿä¸­)`;

                            const secureItemUrl = item.get('imageUrl').replace(/^http:\/\//, 'https://');
                            const garmentBlob = await (await fetch(secureItemUrl)).blob();
                            const humanInput = { background: currentPersonImageBlob, layers: [], composite: null };
                            const description = item.get('note') || "A fashion item";

                            // Dynamic category param? 
                            // Wait, IDM-VTON input doesn't have explicit category string param in typical demo, it usually AUTO-DETECTS or uses the mask checkbox logic.
                            // But usually `category` IS an input (dropdown).
                            // Let's re-verify inputs.
                            // [human, garment, desc, is_checked, is_checked_crop, step, seed]
                            // Where is category?
                            // Maybe it's not exposed in the simplified API? Or maybe it's auto-detected?
                            // PROMPTS usually include "upper body" or "lower body".
                            // If explicit category input is missing, description helps.
                            // I will append category to description. "A photo of upper_body..." ?
                            // Actually, yisol/IDM-VTON demo on HF has a "Category" dropdown.
                            // If I am using `fn_index` implicitly via `/tryon` endpoint name, likely it maps to the main function.
                            // If the main function has Category dropdown, I MUST pass it.
                            // Let's assume input layout: [human, garment, desc, is_checked, is_checked_crop, step, seed]
                            // IF category is missing here, it might be auto.
                            // BUT if it IS required, my previous code worked because `tryOnCategory` wasn't passed?
                            // WAIT, I previously DID NOT PASS `tryOnCategory` in `generateTryOn` (Step 480)!
                            // I passed: [human, garment, desc, true, true, 30, 42].
                            // And user said it worked? Or didn't report error?
                            // User request implies they want multi-select.
                            // If previous worked, it means Category input is either NOT required or defaults.
                            // I will stick to previous inputs but enhance description with category hint just in case.

                            const enhancedDesc = (item.get('note') || "") + ` (${getVtonCategory(item.get('category')).replace('_', ' ')})`;

                            const submission = app.submit("/tryon", [
                                humanInput,          // Human
                                garmentBlob,         // Garment
                                enhancedDesc,        // Description
                                true,                // is_checked
                                true,                // is_checked_crop
                                30,                  // denoise_steps
                                42                   // seed 
                            ]);

                            let stepResultUrl = null;
                            for await (const msg of submission) {
                                if (msg.type === 'status') {
                                    if (msg.stage === 'queue') {
                                        tryOnStatus.value = `[${i + 1}/${itemsToProcess.length}] æ’é˜Ÿä¸­... ä½ç½®: ${msg.queue_index !== undefined ? msg.queue_index + 1 : 'æœªçŸ¥'}`;
                                    } else if (msg.stage === 'generating') {
                                        tryOnStatus.value = `[${i + 1}/${itemsToProcess.length}] æ­£åœ¨ç”Ÿæˆ...`;
                                    }
                                } else if (msg.type === 'data') {
                                    const output = msg.data[0];
                                    if (output && output.url) stepResultUrl = output.url;
                                    else if (typeof output === 'string') stepResultUrl = output;
                                }
                            }

                            if (!stepResultUrl) throw new Error(`ç¬¬ ${i + 1} ä»¶ (${item.get('category')}) ç”Ÿæˆå¤±è´¥`);

                            // Prepare for next
                            tryOnResult.value = stepResultUrl;
                            currentPersonImageBlob = await (await fetch(stepResultUrl)).blob();
                        }

                        tryOnStatus.value = "å…¨éƒ¨ç”Ÿæˆå®Œæˆï¼";

                    } catch (e) {
                        console.error("Try-On Error:", e);
                        alert("ç”Ÿæˆå¤±è´¥: " + e.message);
                        tryOnStatus.value = "å‡ºé”™: " + e.message;
                    } finally {
                        isTryOnProcessing.value = false;
                    }
                };

                const saveTryOnResult = async () => {
                    if (!tryOnResult.value) return;
                    if (!currentTryOnObject.value) return;

                    if (!confirm('ç¡®å®šå°†æ­¤ç”Ÿæˆå›¾ç‰‡è®¾ä¸ºå°é¢å—ï¼Ÿ')) return;

                    try {
                        const res = await fetch(tryOnResult.value);
                        const blob = await res.blob();
                        const file = new File([blob], "tryon_result.jpg", { type: "image/jpeg" });

                        const avFile = await uploadFileToLeanCloud(file);

                        currentTryOnObject.value.set('imageUrl', avFile);
                        await currentTryOnObject.value.save();
                        alert('å·²æ›´æ–°å°é¢ï¼');
                        showTryOnModal.value = false;
                        loadOutfits();
                        loadOotd();
                    } catch (e) {
                        alert('ä¿å­˜å¤±è´¥: ' + e.message);
                    }
                };

                // AIæ­é…åŠŸèƒ½
                const saveAiKey = () => {

                    if (!aiKeyInput.value.trim()) return alert('è¯·è¾“å…¥ AI Key');
                    localStorage.setItem('lc_ai_key', aiKeyInput.value.trim());
                    hasAiKey.value = true;
                    alert('AI Key ä¿å­˜æˆåŠŸï¼');
                };
                const toggleAiCategory = (catName) => {
                    const idx = aiSelectedCategories.value.indexOf(catName);
                    if (idx === -1) aiSelectedCategories.value.push(catName);
                    else aiSelectedCategories.value.splice(idx, 1);
                };
                const generateAiOutfit = async () => {
                    const apiKey = localStorage.getItem('lc_ai_key');
                    if (!apiKey) return alert('è¯·å…ˆåœ¨è¡£æ©±è®¾ç½®ä¸­é…ç½® AI Key');
                    if (items.value.length === 0) return alert('è¡£æ©±é‡Œè¿˜æ²¡æœ‰å•å“ï¼Œè¯·å…ˆæ·»åŠ ä¸€äº›è¡£ç‰©');

                    isAiGenerating.value = true;
                    try {
                        let candidateItems = items.value;
                        if (aiSelectedCategories.value.length > 0) {
                            candidateItems = items.value.filter(i => aiSelectedCategories.value.includes(i.get('category')));
                        }
                        if (candidateItems.length === 0) return alert('æ‰€é€‰åˆ†ç±»ä¸‹æ²¡æœ‰å•å“');

                        const itemsInfo = candidateItems.map(i => ({
                            id: i.id,
                            category: i.get('category'),
                            brand: i.get('brand') || 'æ— å“ç‰Œ',
                            price: i.get('price') || 0,
                            wearCount: i.get('wearCount') || 0
                        }));

                        const categories = [...new Set(itemsInfo.map(i => i.category))];
                        const prompt = `ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„æ—¶å°šæ­é…å¸ˆã€‚æ ¹æ®ç”¨æˆ·è¡£æ©±ä¸­çš„è¡£ç‰©ï¼Œä¸ºç”¨æˆ·æ­é…ä»Šæ—¥ç©¿æ­ã€‚

ç”¨æˆ·è¡£æ©±å•å“å¦‚ä¸‹ï¼ˆJSONæ ¼å¼ï¼‰:
${JSON.stringify(itemsInfo, null, 2)}

å¯ç”¨åˆ†ç±»: ${categories.join(', ')}
ä»Šå¤©æ—¥æœŸ: ${new Date().toLocaleDateString('zh-CN')}

è¯·ä»ä¸Šè¿°å•å“ä¸­é€‰æ‹© 2-4 ä»¶è¿›è¡Œæ­é…ã€‚è¦æ±‚:
1. ä¼˜å…ˆé€‰æ‹©ç©¿ç€æ¬¡æ•°è¾ƒå°‘çš„å•å“ï¼ˆè®©ç”¨æˆ·çš„è¡£ç‰©å¾—åˆ°å……åˆ†åˆ©ç”¨ï¼‰
2. è€ƒè™‘é£æ ¼å’Œè‰²å½©æ­é…
3. ç»™å‡ºæ­é…ç†ç”±

è¯·ç›´æ¥è¿”å› JSON æ ¼å¼ï¼Œä¸è¦åŒ…å« markdown æ ‡è®°:
{
  "selectedIds": ["å•å“id1", "å•å“id2", ...],
  "reason": "æ­é…ç†ç”±è¯´æ˜ï¼ˆ50-100å­—ï¼‰"
}`;

                        const response = await fetch("https://openrouter.ai/api/v1/chat/completions", {
                            method: "POST",
                            headers: { "Authorization": `Bearer ${apiKey}`, "Content-Type": "application/json" },
                            body: JSON.stringify({ "model": "google/gemini-2.0-flash-exp:free", "messages": [{ "role": "user", "content": prompt }] })
                        });

                        if (!response.ok) {
                            if (response.status === 429) {
                                throw new Error('APIè¯·æ±‚è¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åå†è¯•ï¼ˆå…è´¹æ¨¡å‹æœ‰è°ƒç”¨é¢‘ç‡é™åˆ¶ï¼‰');
                            }
                            throw new Error(`API Error: ${response.status}`);
                        }

                        const result = await response.json();
                        let content = result.choices[0].message.content;
                        content = content.replace(/```json/g, '').replace(/```/g, '').trim();
                        const jsonMatch = content.match(/\{[\s\S]*\}/);
                        if (jsonMatch) content = jsonMatch[0];

                        const data = JSON.parse(content);
                        const selectedItems = data.selectedIds.map(id => items.value.find(i => i.id === id)).filter(Boolean);
                        if (selectedItems.length === 0) throw new Error('æœªæ‰¾åˆ°åŒ¹é…å•å“');

                        aiResult.items = selectedItems;
                        aiResult.reason = data.reason || 'AIä¸ºæ‚¨æ¨èäº†è¿™å¥—æ­é…';
                        showAiResultModal.value = true;
                    } catch (e) {
                        console.error(e);
                        alert('AIæ­é…å¤±è´¥: ' + e.message);
                    } finally {
                        isAiGenerating.value = false;
                    }
                };
                const saveAiOutfit = async () => {
                    if (aiResult.items.length === 0) return;
                    const ObjClass = AV.Object.extend('WardrobeOutfit');
                    const obj = new ObjClass();
                    obj.set('owner', currentUser.value);
                    obj.setACL(new AV.ACL(currentUser.value));
                    obj.set('name', 'AIæ­é…-' + new Date().toLocaleDateString('zh-CN'));
                    obj.set('note', 'ğŸ¤– AIæ­é…ç†ç”±: ' + aiResult.reason);
                    obj.set('itemIds', aiResult.items.map(i => i.id));
                    obj.set('isAiGenerated', true);
                    try {
                        await obj.save();
                        showAiResultModal.value = false;
                        showOutfitModal.value = false;
                        loadOutfits();
                        alert('æ­é…å·²ä¿å­˜ï¼');
                    } catch (e) { alert('ä¿å­˜å¤±è´¥: ' + e.message); }
                };

                // åˆå§‹åŒ–æ—¶æ£€æŸ¥ AI Key
                const storedAiKey = localStorage.getItem('lc_ai_key');
                if (storedAiKey) { aiKeyInput.value = storedAiKey; hasAiKey.value = true; }

                // OOTDæ“ä½œ
                const openAddOotdModal = () => {
                    isEditingOotd.value = false;
                    editingObject.value = null;
                    Object.assign(ootdForm, { imageUrl: '', date: new Date().toISOString().split('T')[0], title: '', note: '', selectedItems: [] });
                    ootdPickerCategory.value = '';
                    tempUploadedFiles.value = [];
                    showOotdModal.value = true;
                };
                const handleOotdImageUpload = async (e) => { const file = e.target.files[0]; if (!file) return; if (file.size > 5 * 1024 * 1024) { alert('å›¾ç‰‡ä¸èƒ½è¶…è¿‡5MB'); return; } isUploading.value = true; try { ootdForm.imageUrl = await uploadFileToLeanCloud(file); } catch (err) { alert('ä¸Šä¼ å¤±è´¥'); } finally { isUploading.value = false; e.target.value = ''; } };
                const removeOotdImage = async () => { if (ootdForm.imageUrl && !isEditingOotd.value) { await deleteFileByUrl(ootdForm.imageUrl); } ootdForm.imageUrl = ''; };
                const closeOotdModal = async () => {
                    // å¦‚æœæ˜¯æ–°å»ºæ¨¡å¼ä¸”æœ‰ä¸´æ—¶ä¸Šä¼ çš„æ–‡ä»¶ï¼Œåˆ é™¤å®ƒä»¬
                    if (!isEditingOotd.value && tempUploadedFiles.value.length > 0) {
                        for (const f of tempUploadedFiles.value) {
                            try { await f.destroy(); } catch (e) { console.warn('æ¸…ç†ä¸´æ—¶æ–‡ä»¶å¤±è´¥:', e); }
                        }
                    }
                    tempUploadedFiles.value = [];
                    showOotdModal.value = false;
                };

                // æ£€æŸ¥æ­é…æ˜¯å¦å·²å­˜åœ¨
                const isOutfitExists = (itemIds) => {
                    const sortedIds = [...itemIds].sort().join(',');
                    return outfits.value.some(o => {
                        const existingIds = [...(o.get('itemIds') || [])].sort().join(',');
                        return existingIds === sortedIds;
                    });
                };

                const saveOotd = async () => {
                    if (ootdForm.selectedItems.length === 0) return alert('è¯·é€‰æ‹©ä»Šæ—¥ç©¿çš„è¡£ç‰©');
                    const ObjClass = AV.Object.extend('WardrobeOOTD');
                    const obj = isEditingOotd.value ? editingObject.value : new ObjClass();
                    if (!isEditingOotd.value) {
                        obj.set('owner', currentUser.value);
                        obj.setACL(new AV.ACL(currentUser.value));
                    }
                    obj.set('imageUrl', ootdForm.imageUrl);
                    obj.set('date', ootdForm.date);
                    obj.set('title', ootdForm.title || 'ä»Šæ—¥ç©¿æ­');
                    obj.set('note', ootdForm.note);
                    obj.set('itemIds', ootdForm.selectedItems);

                    try {
                        await obj.save();

                        // æ£€æŸ¥æ˜¯å¦éœ€è¦åŒæ­¥åˆ°æ­é…ï¼ˆå¦‚æœæ­é…ä¸é‡å¤ï¼‰
                        if (!isEditingOotd.value && !isOutfitExists(ootdForm.selectedItems)) {
                            const OutfitClass = AV.Object.extend('WardrobeOutfit');
                            const outfitObj = new OutfitClass();
                            outfitObj.set('owner', currentUser.value);
                            outfitObj.setACL(new AV.ACL(currentUser.value));
                            outfitObj.set('name', 'OOTD-' + ootdForm.date);
                            outfitObj.set('note', 'æ¥è‡ªOOTD: ' + (ootdForm.title || 'ä»Šæ—¥ç©¿æ­'));
                            outfitObj.set('itemIds', ootdForm.selectedItems);
                            outfitObj.set('fromOotd', true);
                            await outfitObj.save();
                            loadOutfits();
                        }

                        tempUploadedFiles.value = [];
                        showOotdModal.value = false;
                        loadOotd();
                        alert('ç©¿æ­è®°å½•å·²ä¿å­˜ï¼');
                    } catch (e) { alert('ä¿å­˜å¤±è´¥: ' + e.message); }
                };
                const openOotdDetail = (ootd) => {
                    currentOotd.value = ootd;
                    showOotdDetailModal.value = true;
                };
                const editOotd = (ootd) => {
                    showOotdDetailModal.value = false;
                    isEditingOotd.value = true;
                    editingObject.value = ootd;
                    Object.assign(ootdForm, {
                        imageUrl: ootd.get('imageUrl') || '',
                        date: ootd.get('date') || new Date().toISOString().split('T')[0],
                        title: ootd.get('title') || '',
                        note: ootd.get('note') || '',
                        selectedItems: [...(ootd.get('itemIds') || [])]
                    });
                    ootdPickerCategory.value = '';
                    tempUploadedFiles.value = [];
                    showOotdModal.value = true;
                };
                const deleteOotd = async (ootd) => {
                    if (confirm('ç¡®è®¤åˆ é™¤æ­¤ç©¿æ­è®°å½•ï¼Ÿ')) {
                        try {
                            await ootd.destroy();
                            showOotdDetailModal.value = false;
                            loadOotd();
                        } catch (e) { alert('åˆ é™¤å¤±è´¥: ' + e.message); }
                    }
                };
                const formatDate = (dateStr) => { if (!dateStr) return ''; const d = new Date(dateStr); return `${d.getFullYear()}å¹´${d.getMonth() + 1}æœˆ${d.getDate()}æ—¥`; };

                return {
                    isReady, hasConfig, currentUser, currentView, isUploading,
                    configForm, authMode, authForm, itemForm, outfitForm, ootdForm,
                    items, outfits, ootdList, categoryList, closetFilters, newCategoryName,
                    totalItems, totalValue, totalOutfits, totalOotd, currentViewTitle, displayCategories,
                    showItemModal, showOutfitModal, showOotdModal, showItemDetailModal, showAiResultModal,
                    showCategoryDetailModal, categoryDetailName, categoryDetailSort,
                    categoryDetailMinPrice, categoryDetailMaxPrice, categoryDetailMinWear, categoryDetailMaxWear,
                    filteredCategoryItems, openCategoryDetail, resetCategoryDetailFilters, toggleClosetFilter,
                    showOutfitDetailModal, currentOutfit, deleteOutfit, editOutfit,
                    showOotdDetailModal, currentOotd, editOotd, deleteOotd,
                    outfitSearchKeyword, filteredOutfits, ootdSearchKeyword,
                    ootdDateFrom, ootdDateTo, filteredOotdList, ootdPickerCategory, filteredOotdPickerItems, toggleOotdItem,
                    isEditingItem, isEditingOutfit, isEditingOotd, currentItem,
                    aiKeyInput, hasAiKey, isAiGenerating, aiSelectedCategories, aiResult,
                    outfitPickerCategory, outfitPickerSort, outfitPickerMaxPrice, filteredPickerItems,
                    getItemById, toggleOutfitItem,
                    saveConfig, clearConfig, handleAuth, handleLogout,
                    addCategory, removeCategory, getCategoryIcon, getCategoryCount,
                    openAddItemModal, handleItemImageUpload, removeItemImage, closeItemModal, saveItem,
                    openItemDetail, editItem, deleteItem, wearItem,
                    openAddOutfitModal, handleOutfitImageUpload, removeOutfitImage, closeOutfitModal, saveOutfit, openOutfitDetail,
                    saveAiKey, toggleAiCategory, generateAiOutfit, saveAiOutfit,
                    saveAiKey, toggleAiCategory, generateAiOutfit, saveAiOutfit,
                    openAddOotdModal, handleOotdImageUpload, removeOotdImage, closeOotdModal, saveOotd, openOotdDetail, formatDate,
                    // AI Try-On
                    hfTokenInput, hasHfToken, saveHfToken, customSpaceIdInput, hasCustomSpace, saveCustomSpace,
                    showTryOnModal, tryOnModelImage, selectedTryOnItem, selectedTryOnItems, tryOnCategory, tryOnResult, isTryOnProcessing, tryOnStatus, tryOnCandidateItems, canTryOn,
                    openAiTryOn, selectTryOnItem, generateTryOn, saveTryOnResult,
                    modelsList, uploadNewModel, deleteModel
                };
            }
        }).mount('#app');
    </script>
</body>

</html>